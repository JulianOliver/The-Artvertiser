<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>bazar: /home/julian/devel/artvertiser/garfeild/keypoints/yape.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1be09642b1728ac69a5f1a111e5847b4.html">garfeild</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_179441f46b36644b3554ebe468520e3e.html">keypoints</a>
  </div>
</div>
<div class="contents">
<h1>yape.cpp</h1><a href="yape_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">Copyright 2005, 2006 Computer Vision Lab, </span>
<a name="l00003"></a>00003 <span class="comment">Ecole Polytechnique Federale de Lausanne (EPFL), Switzerland. </span>
<a name="l00004"></a>00004 <span class="comment">All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">This file is part of BazAR.</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">BazAR is free software; you can redistribute it and/or modify it under the</span>
<a name="l00009"></a>00009 <span class="comment">terms of the GNU General Public License as published by the Free Software</span>
<a name="l00010"></a>00010 <span class="comment">Foundation; either version 2 of the License, or (at your option) any later</span>
<a name="l00011"></a>00011 <span class="comment">version.</span>
<a name="l00012"></a>00012 <span class="comment"></span>
<a name="l00013"></a>00013 <span class="comment">BazAR is distributed in the hope that it will be useful, but WITHOUT ANY</span>
<a name="l00014"></a>00014 <span class="comment">WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A</span>
<a name="l00015"></a>00015 <span class="comment">PARTICULAR PURPOSE. See the GNU General Public License for more details.</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">You should have received a copy of the GNU General Public License along with</span>
<a name="l00018"></a>00018 <span class="comment">BazAR; if not, write to the Free Software Foundation, Inc., 51 Franklin</span>
<a name="l00019"></a>00019 <span class="comment">Street, Fifth Floor, Boston, MA 02110-1301, USA </span>
<a name="l00020"></a>00020 <span class="comment">*/</span>
<a name="l00021"></a>00021 <span class="comment">/*</span>
<a name="l00022"></a>00022 <span class="comment">* Author:</span>
<a name="l00023"></a>00023 <span class="comment">* Vincent Lepetit &lt;vincent.lepetit@epfl.ch&gt;</span>
<a name="l00024"></a>00024 <span class="comment">* 2004/2005</span>
<a name="l00025"></a>00025 <span class="comment">*/</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="keyword">using namespace </span>std;
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="starter_8h.html">starter.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include "<a class="code" href="yape_8h.html">yape.h</a>"</span>
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="yape_8cpp.html#d7ccb0601e65529846417fff785105cd">00039</a> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="yape_8cpp.html#d7ccb0601e65529846417fff785105cd">yape_bin_size</a> = 1000;
<a name="l00040"></a><a class="code" href="yape_8cpp.html#e6afe16508f8da8316dafd354b1be088">00040</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="yape_8cpp.html#e6afe16508f8da8316dafd354b1be088">yape_tmp_points_array_size</a> = 10000;
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="yape_8cpp.html#491a493976a8db3b04467e3d1336a141">00042</a> <span class="keywordtype">bool</span> <a class="code" href="yape_8cpp.html#491a493976a8db3b04467e3d1336a141">operator &lt;</a>(<span class="keyword">const</span> <a class="code" href="classkeypoint.html" title="A 2D feature point as detected by a point detector (yape for example).">keypoint</a> &amp;p1, <span class="keyword">const</span> <a class="code" href="classkeypoint.html" title="A 2D feature point as detected by a point detector (yape for example).">keypoint</a> &amp;p2)
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044   <span class="keywordflow">return</span> p1.<a class="code" href="classkeypoint.html#33bd514940806485e3c8c03233f6d613" title="higher is the score, stronger is the point">score</a> &gt; p2.<a class="code" href="classkeypoint.html#33bd514940806485e3c8c03233f6d613" title="higher is the score, stronger is the point">score</a>;
<a name="l00045"></a>00045 }
<a name="l00046"></a>00046 
<a name="l00047"></a><a class="code" href="classyape.html#43553da7a678361e2da1e50b62f13935">00047</a> <a class="code" href="classyape.html#43553da7a678361e2da1e50b62f13935" title="Constructor for detection in width x height images.">yape::yape</a>(<span class="keywordtype">int</span> _width, <span class="keywordtype">int</span> _height)
<a name="l00048"></a>00048 {
<a name="l00049"></a>00049   <a class="code" href="classyape.html#119bb646647df61e4c4bb65cdd30a1d5">width</a> = _width;
<a name="l00050"></a>00050   <a class="code" href="classyape.html#f61a8ac8e4ae6607713b5bd96a599a1e">height</a> = _height;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   <a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a> = 7;
<a name="l00053"></a>00053   <a class="code" href="classyape.html#e49f2128c475e1c7ca0b647d5602ebba">tau</a> = 10;
<a name="l00054"></a>00054   <a class="code" href="classyape.html#f35b3d8b6630041fd41e67ca584e55bb">minimal_neighbor_number</a> = 4;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056   <a class="code" href="classyape.html#1f6287666093d0b72c09b7b835f8728c">activate_bins</a>();
<a name="l00057"></a>00057   <a class="code" href="classyape.html#94e152f6fe99a852c01e4a6dfdc4367e">set_bins_number</a>(4, 4);
<a name="l00058"></a>00058 
<a name="l00059"></a>00059   <a class="code" href="classyape.html#6c2b9c2053195bb694b91ff1a5185349">disactivate_subpixel</a>();
<a name="l00060"></a>00060 
<a name="l00061"></a>00061   <a class="code" href="classyape.html#5a9d72e6e2027f270a1883d7122dffda">set_minimal_neighbor_number</a>(3);
<a name="l00062"></a>00062 
<a name="l00063"></a>00063   <a class="code" href="classyape.html#4924657a429d2ac67ca91be4189e1f31">init_for_monoscale</a>();
<a name="l00064"></a>00064 }
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="classyape.html#957c1be85536678f28f2287c3d4095ec">00066</a> <a class="code" href="classyape.html#957c1be85536678f28f2287c3d4095ec">yape::~yape</a>()
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068   <span class="keywordflow">if</span> (<a class="code" href="classyape.html#6a57527a8a0c8e41317549015a198cd8">Dirs</a>) <span class="keyword">delete</span> <a class="code" href="classyape.html#6a57527a8a0c8e41317549015a198cd8">Dirs</a>;
<a name="l00069"></a>00069   <span class="keywordflow">if</span> (<a class="code" href="classyape.html#82e9bd81eb5cd0b077cc81059a744935">Dirs_nb</a>) <span class="keyword">delete</span>[] <a class="code" href="classyape.html#82e9bd81eb5cd0b077cc81059a744935">Dirs_nb</a>;
<a name="l00070"></a>00070   <span class="keywordflow">if</span> (<a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>) cvReleaseImage(&amp;<a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>);
<a name="l00071"></a>00071   <span class="keywordflow">if</span> (<a class="code" href="classyape.html#19e262558ad9f0f1273dca90f0f392e7">filtered_image</a>) cvReleaseImage(&amp;<a class="code" href="classyape.html#19e262558ad9f0f1273dca90f0f392e7">filtered_image</a>);
<a name="l00072"></a>00072 }
<a name="l00073"></a>00073 
<a name="l00074"></a><a class="code" href="classyape.html#55c02375d9d672b31626006f0f02c3bd">00074</a> <span class="keywordtype">int</span> <a class="code" href="classyape.html#55c02375d9d672b31626006f0f02c3bd" title="Static function for point detection. Slower but avoids an instantiation.">yape::static_detect</a>(IplImage * <a class="code" href="artvertiser_8cpp.html#50c401d9f2e3a164c7d3dceb70b18771">image</a>, <a class="code" href="classkeypoint.html" title="A 2D feature point as detected by a point detector (yape for example).">keypoint</a> * points, <span class="keywordtype">int</span> max_point_number, <span class="keywordtype">int</span> _radius, <span class="keywordtype">int</span> _tau)
<a name="l00075"></a>00075 {
<a name="l00076"></a>00076   <a class="code" href="classyape.html" title="YAPE feature point detector.">yape</a> * pe = <span class="keyword">new</span> <a class="code" href="classyape.html#43553da7a678361e2da1e50b62f13935" title="Constructor for detection in width x height images.">yape</a>(image-&gt;width, image-&gt;height);
<a name="l00077"></a>00077 
<a name="l00078"></a>00078   pe-&gt;<a class="code" href="classyape.html#b39643035bebbf99f92d7541ab436e3a">set_radius</a>(_radius);
<a name="l00079"></a>00079   pe-&gt;<a class="code" href="classyape.html#7630435baca8d10aced14ab2b4d0c196">set_tau</a>(_tau);
<a name="l00080"></a>00080   <span class="keywordtype">int</span> point_number = pe-&gt;<a class="code" href="classyape.html#be06c02e6b77150ac03766158064e85d">detect</a>(image, points, max_point_number);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082   <span class="keyword">delete</span> pe;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   <span class="keywordflow">return</span> point_number;
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="classyape.html#b39643035bebbf99f92d7541ab436e3a">00087</a> <span class="keywordtype">void</span> <a class="code" href="classyape.html#b39643035bebbf99f92d7541ab436e3a">yape::set_radius</a>(<span class="keywordtype">int</span> _radius)
<a name="l00088"></a>00088 {
<a name="l00089"></a>00089   <a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a> = _radius;
<a name="l00090"></a>00090 }
<a name="l00091"></a>00091 
<a name="l00092"></a><a class="code" href="classyape.html#7630435baca8d10aced14ab2b4d0c196">00092</a> <span class="keywordtype">void</span> <a class="code" href="classyape.html#7630435baca8d10aced14ab2b4d0c196">yape::set_tau</a>(<span class="keywordtype">int</span> _tau)
<a name="l00093"></a>00093 {
<a name="l00094"></a>00094   <a class="code" href="classyape.html#e49f2128c475e1c7ca0b647d5602ebba">tau</a> = _tau;
<a name="l00095"></a>00095 }
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="classyape.html#4924657a429d2ac67ca91be4189e1f31">00097</a> <span class="keywordtype">void</span> <a class="code" href="classyape.html#4924657a429d2ac67ca91be4189e1f31">yape::init_for_monoscale</a>(<span class="keywordtype">void</span>)
<a name="l00098"></a>00098 {
<a name="l00099"></a>00099   <a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a> = cvCreateImage(cvSize(<a class="code" href="classyape.html#119bb646647df61e4c4bb65cdd30a1d5">width</a>, <a class="code" href="classyape.html#f61a8ac8e4ae6607713b5bd96a599a1e">height</a>), IPL_DEPTH_16S, 1);
<a name="l00100"></a>00100   <a class="code" href="classyape.html#19e262558ad9f0f1273dca90f0f392e7">filtered_image</a> = cvCreateImage(cvSize(<a class="code" href="classyape.html#119bb646647df61e4c4bb65cdd30a1d5">width</a>, <a class="code" href="classyape.html#f61a8ac8e4ae6607713b5bd96a599a1e">height</a>), IPL_DEPTH_8U, 1);
<a name="l00101"></a>00101 
<a name="l00102"></a>00102   <a class="code" href="classyape.html#6a57527a8a0c8e41317549015a198cd8">Dirs</a> = <span class="keyword">new</span> <a class="code" href="structyape_1_1dir__table.html">dir_table</a>;
<a name="l00103"></a>00103   memset(<a class="code" href="classyape.html#6a57527a8a0c8e41317549015a198cd8">Dirs</a>,0,<span class="keyword">sizeof</span>(<a class="code" href="structyape_1_1dir__table.html">dir_table</a>));
<a name="l00104"></a>00104   <a class="code" href="classyape.html#82e9bd81eb5cd0b077cc81059a744935">Dirs_nb</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="yape_8h.html#874c06fd995c35f62a4c77c64b880164">yape_max_radius</a>];
<a name="l00105"></a>00105   memset(<a class="code" href="classyape.html#82e9bd81eb5cd0b077cc81059a744935">Dirs_nb</a>,0,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*<a class="code" href="yape_8h.html#874c06fd995c35f62a4c77c64b880164">yape_max_radius</a>);
<a name="l00106"></a>00106   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> R = 1; R &lt; yape_max_radius; R++)
<a name="l00107"></a>00107     <a class="code" href="classyape.html#170b352e90f4f55e1ac5b5a87aa801f6">precompute_directions</a>(<a class="code" href="classyape.html#19e262558ad9f0f1273dca90f0f392e7">filtered_image</a>, <a class="code" href="classyape.html#6a57527a8a0c8e41317549015a198cd8">Dirs</a>-&gt;<a class="code" href="structyape_1_1dir__table.html#18fe9092f27f50057891f62b6e4bf906">t</a>[R], &amp;(<a class="code" href="classyape.html#82e9bd81eb5cd0b077cc81059a744935">Dirs_nb</a>[R]), R);
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
<a name="l00110"></a><a class="code" href="classyape.html#52bc96b62aca4025bd6f1a3a4525cf6d">00110</a> <span class="keywordtype">void</span> <a class="code" href="classyape.html#52bc96b62aca4025bd6f1a3a4525cf6d">yape::reserve_tmp_arrays</a>(<span class="keywordtype">void</span>)
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112   <span class="keywordflow">if</span> (<a class="code" href="classyape.html#598d88c4bec37b5a0d37309c65c9c518">use_bins</a>)
<a name="l00113"></a>00113     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classyape.html#41d6681f3187bff4bdd6a6c5a9f2a89b">bin_nb_u</a>; i++)
<a name="l00114"></a>00114       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classyape.html#c96236772c47a4d05da4bce2760a3857">bin_nb_v</a>; j++)
<a name="l00115"></a>00115       {
<a name="l00116"></a>00116         <a class="code" href="classyape.html#ce9a94d167d0edc352e5b1a4e9603834">bins</a>[i][j].clear();
<a name="l00117"></a>00117         <a class="code" href="classyape.html#ce9a94d167d0edc352e5b1a4e9603834">bins</a>[i][j].reserve(<a class="code" href="yape_8cpp.html#d7ccb0601e65529846417fff785105cd">yape_bin_size</a>); 
<a name="l00118"></a>00118       }
<a name="l00119"></a>00119   <span class="keywordflow">else</span>
<a name="l00120"></a>00120   {
<a name="l00121"></a>00121     <a class="code" href="classyape.html#7043625f249116e3258a0ff02829b479">tmp_points</a>.clear();
<a name="l00122"></a>00122     <a class="code" href="classyape.html#7043625f249116e3258a0ff02829b479">tmp_points</a>.reserve(<a class="code" href="yape_8cpp.html#e6afe16508f8da8316dafd354b1be088">yape_tmp_points_array_size</a>);
<a name="l00123"></a>00123   }
<a name="l00124"></a>00124 }
<a name="l00125"></a>00125 
<a name="l00126"></a><a class="code" href="classyape.html#170b352e90f4f55e1ac5b5a87aa801f6">00126</a> <span class="keywordtype">void</span> <a class="code" href="classyape.html#170b352e90f4f55e1ac5b5a87aa801f6">yape::precompute_directions</a>(IplImage * <a class="code" href="artvertiser_8cpp.html#50c401d9f2e3a164c7d3dceb70b18771">image</a>, <span class="keywordtype">short</span> * _Dirs, <span class="keywordtype">int</span> * _Dirs_nb, <span class="keywordtype">int</span> R)
<a name="l00127"></a>00127 {
<a name="l00128"></a>00128   <span class="keywordtype">int</span> widthStep = image-&gt;widthStep;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130   <span class="keywordtype">int</span> i = 0;
<a name="l00131"></a>00131   <span class="keywordtype">int</span> x, y;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133   x = R;
<a name="l00134"></a>00134   <span class="keywordflow">for</span>(y = 0; y &lt; x; y++, i++)
<a name="l00135"></a>00135   {
<a name="l00136"></a>00136     x = int(sqrt(<span class="keywordtype">double</span>(R * R - y * y)) + 0.5);
<a name="l00137"></a>00137     _Dirs[i] = short(x + widthStep * y);
<a name="l00138"></a>00138   }
<a name="l00139"></a>00139   <span class="keywordflow">for</span>(x-- ; x &lt; y &amp;&amp; x &gt;= 0; x--, i++)
<a name="l00140"></a>00140   {
<a name="l00141"></a>00141     y = int(sqrt(<span class="keywordtype">double</span>(R * R - x * x)) + 0.5);
<a name="l00142"></a>00142     _Dirs[i] = short(x + widthStep * y);
<a name="l00143"></a>00143   }
<a name="l00144"></a>00144   <span class="keywordflow">for</span>( ; -x &lt; y; x--, i++)
<a name="l00145"></a>00145   {
<a name="l00146"></a>00146     y = int(sqrt(<span class="keywordtype">double</span>(R * R - x * x)) + 0.5);
<a name="l00147"></a>00147     _Dirs[i] = short(x + widthStep * y);
<a name="l00148"></a>00148   }
<a name="l00149"></a>00149   <span class="keywordflow">for</span>(y-- ; y &gt;= 0; y--, i++)
<a name="l00150"></a>00150   {
<a name="l00151"></a>00151     x = int(-sqrt(<span class="keywordtype">double</span>(R * R - y * y)) - 0.5);
<a name="l00152"></a>00152     _Dirs[i] = short(x + widthStep * y);
<a name="l00153"></a>00153   }
<a name="l00154"></a>00154   <span class="keywordflow">for</span>(; y &gt; x; y--, i++)
<a name="l00155"></a>00155   {
<a name="l00156"></a>00156     x = int(-sqrt(<span class="keywordtype">double</span>(R * R - y * y)) - 0.5);
<a name="l00157"></a>00157     _Dirs[i] = short(x + widthStep * y);
<a name="l00158"></a>00158   }
<a name="l00159"></a>00159   <span class="keywordflow">for</span>(x++ ; x &lt;= 0; x++, i++)
<a name="l00160"></a>00160   {
<a name="l00161"></a>00161     y = int(-sqrt(<span class="keywordtype">double</span>(R * R - x * x)) - 0.5);
<a name="l00162"></a>00162     _Dirs[i] = short(x + widthStep * y);
<a name="l00163"></a>00163   }
<a name="l00164"></a>00164   <span class="keywordflow">for</span>( ; x &lt; -y; x++, i++)
<a name="l00165"></a>00165   {
<a name="l00166"></a>00166     y = int(-sqrt(<span class="keywordtype">double</span>(R * R - x * x)) - 0.5);
<a name="l00167"></a>00167     _Dirs[i] = short(x + widthStep * y);
<a name="l00168"></a>00168   }
<a name="l00169"></a>00169   <span class="keywordflow">for</span>(y++ ; y &lt; 0; y++, i++)
<a name="l00170"></a>00170   {
<a name="l00171"></a>00171     x = int(sqrt(<span class="keywordtype">double</span>(R * R - y * y)) + 0.5);
<a name="l00172"></a>00172     _Dirs[i] = short(x + widthStep * y);
<a name="l00173"></a>00173   }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175   *_Dirs_nb = i;
<a name="l00176"></a>00176   _Dirs[i] = _Dirs[0];
<a name="l00177"></a>00177   _Dirs[i + 1] = _Dirs[1];
<a name="l00178"></a>00178 }
<a name="l00179"></a>00179 
<a name="l00180"></a><a class="code" href="classyape.html#67f813e2f3a86941d8affc5efd03aca8">00180</a> <span class="keywordtype">void</span> <a class="code" href="classyape.html#67f813e2f3a86941d8affc5efd03aca8" title="Save a color image with the detected points on the original image. Useful for visualisation...">yape::save_image_of_detected_points</a>(<span class="keywordtype">char</span> * name, IplImage * <a class="code" href="artvertiser_8cpp.html#50c401d9f2e3a164c7d3dceb70b18771">image</a>, <a class="code" href="classkeypoint.html" title="A 2D feature point as detected by a point detector (yape for example).">keypoint</a> * points, <span class="keywordtype">int</span> points_nb)
<a name="l00181"></a>00181 {
<a name="l00182"></a>00182   IplImage * color_image = <a class="code" href="mcv_8cpp.html#00daa6acc2cf7a4add70027464dde828">mcvGrayToColor</a>(image);
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; points_nb; i++) {
<a name="l00185"></a>00185     <span class="keywordtype">int</span> s = (int)points[i].scale;
<a name="l00186"></a>00186     <span class="keywordtype">float</span> x = <a class="code" href="classPyrImage.html#731d4bcd182e9e41d0d5c15edeb26c77" title="Convert a subpixel coordinate from one level to another.">PyrImage::convCoordf</a>(points[i].u, s, 0);
<a name="l00187"></a>00187     <span class="keywordtype">float</span> y = <a class="code" href="classPyrImage.html#731d4bcd182e9e41d0d5c15edeb26c77" title="Convert a subpixel coordinate from one level to another.">PyrImage::convCoordf</a>(points[i].v, s, 0);
<a name="l00188"></a>00188     <span class="keywordtype">float</span> l = <a class="code" href="classPyrImage.html#731d4bcd182e9e41d0d5c15edeb26c77" title="Convert a subpixel coordinate from one level to another.">PyrImage::convCoordf</a>(32.0f, s, 0);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <a class="code" href="mcv_8cpp.html#2b5ba662a3284fedbc92105794f119cc">mcvCircle</a>(color_image, <span class="keywordtype">int</span>(x), <span class="keywordtype">int</span>(y), (<span class="keywordtype">int</span>)l, <a class="code" href="mcv_8cpp.html#316e2e1ff0ab13832d77795bcb026ffa">mcvRainbowColor</a>(s % 7));
<a name="l00191"></a>00191   }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193   <a class="code" href="mcv_8cpp.html#c9dffb4820093e8353a009bc19b800a5">mcvSaveImage</a>(name, color_image);
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00196"></a><a class="code" href="classyape.html#ffc2979fd7c28b2380326f4bd1c1ec36">00196</a> <span class="keywordtype">bool</span> <a class="code" href="classyape.html#ffc2979fd7c28b2380326f4bd1c1ec36">yape::double_check</a>(IplImage * <a class="code" href="artvertiser_8cpp.html#50c401d9f2e3a164c7d3dceb70b18771">image</a>, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">short</span> * dirs, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> dirs_nb)
<a name="l00197"></a>00197 {
<a name="l00198"></a>00198   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * I = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(image-&gt;imageData + y * image-&gt;widthStep);
<a name="l00199"></a>00199   <span class="keywordtype">int</span> Ip = I[x] + <a class="code" href="classyape.html#e49f2128c475e1c7ca0b647d5602ebba">tau</a>;
<a name="l00200"></a>00200   <span class="keywordtype">int</span> Im = I[x] - tau;
<a name="l00201"></a>00201   <span class="keywordtype">int</span> <a class="code" href="classyape.html#9c2d0562b689e085607be419841f8343">A</a>;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203   <span class="keywordflow">for</span>(A = dirs_nb / 2 - 2; A &lt;= dirs_nb / 2 + 2; A++)
<a name="l00204"></a>00204     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; dirs_nb - A; i++)
<a name="l00205"></a>00205     {
<a name="l00206"></a>00206       <span class="keywordflow">if</span> (I[x+dirs[i]] &gt; Im &amp;&amp; I[x+dirs[i]] &lt; Ip &amp;&amp; I[x+dirs[i+A]] &gt; Im &amp;&amp; I[x+dirs[i+A]] &lt; Ip)
<a name="l00207"></a>00207         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00213"></a><a class="code" href="yape_8cpp.html#d3341a57bfbb708756b3a44247debe99">00213</a> <span class="preprocessor">#define A_INF (A &lt; Im)</span>
<a name="l00214"></a><a class="code" href="yape_8cpp.html#6283cd298b1f6f63a4c65452879c9f46">00214</a> <span class="preprocessor"></span><span class="preprocessor">#define A_SUP (A &gt; Ip)</span>
<a name="l00215"></a><a class="code" href="yape_8cpp.html#3b46aa7dff1682b1dde0b6939eee9db3">00215</a> <span class="preprocessor"></span><span class="preprocessor">#define A_NOT_INF (A &gt;= Im)</span>
<a name="l00216"></a><a class="code" href="yape_8cpp.html#5a4ab9796ee659e8c7f1f7df6adce256">00216</a> <span class="preprocessor"></span><span class="preprocessor">#define A_NOT_SUP (A &lt;= Ip)</span>
<a name="l00217"></a>00217 <span class="preprocessor"></span>
<a name="l00218"></a><a class="code" href="yape_8cpp.html#a65bd2ace10342db24134b9db1c06ccd">00218</a> <span class="preprocessor">#define B0_INF (B0 &lt; Im)</span>
<a name="l00219"></a><a class="code" href="yape_8cpp.html#f6507a01dc5603256e81e23760af4667">00219</a> <span class="preprocessor"></span><span class="preprocessor">#define B0_SUP (B0 &gt; Ip)</span>
<a name="l00220"></a><a class="code" href="yape_8cpp.html#db8df7e3e02c92bb61f6328d30d66d6f">00220</a> <span class="preprocessor"></span><span class="preprocessor">#define B0_NOT_INF (B0 &gt;= Im)</span>
<a name="l00221"></a><a class="code" href="yape_8cpp.html#a62725bfe95c0b0351238e3e90e07389">00221</a> <span class="preprocessor"></span><span class="preprocessor">#define B0_NOT_SUP (B0 &lt;= Ip)</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span>
<a name="l00223"></a><a class="code" href="yape_8cpp.html#20f674e01986f34077be1d2162e595a3">00223</a> <span class="preprocessor">#define B1_INF (B1 &lt; Im)</span>
<a name="l00224"></a><a class="code" href="yape_8cpp.html#1a960747725b5b58f3c75aabd61ece6f">00224</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_SUP (B1 &gt; Ip)</span>
<a name="l00225"></a><a class="code" href="yape_8cpp.html#b750a4bbf9096c134429f4d2ae5aebfa">00225</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_NOT_INF (B1 &gt;= Im)</span>
<a name="l00226"></a><a class="code" href="yape_8cpp.html#ae552540150c061e1c93b099eb80356f">00226</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_NOT_SUP (B1 &lt;= Ip)</span>
<a name="l00227"></a>00227 <span class="preprocessor"></span>
<a name="l00228"></a><a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">00228</a> <span class="preprocessor">#define B2_INF (B2 &lt; Im)</span>
<a name="l00229"></a><a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">00229</a> <span class="preprocessor"></span><span class="preprocessor">#define B2_SUP (B2 &gt; Ip)</span>
<a name="l00230"></a><a class="code" href="yape_8cpp.html#44e15b3c3c05eb56c8efb451ddeb739f">00230</a> <span class="preprocessor"></span><span class="preprocessor">#define B2_NOT_INF (B2 &gt;= Im)</span>
<a name="l00231"></a><a class="code" href="yape_8cpp.html#c47b98b323797b3c210e0fd6fa43d9d8">00231</a> <span class="preprocessor"></span><span class="preprocessor">#define B2_NOT_SUP (B2 &lt;= Ip)</span>
<a name="l00232"></a>00232 <span class="preprocessor"></span>
<a name="l00233"></a><a class="code" href="yape_8cpp.html#a506ce31982f4c26691c029dffc6de5d">00233</a> <span class="preprocessor">#define GET_A()   A = I[x+dirs[a]]</span>
<a name="l00234"></a><a class="code" href="yape_8cpp.html#6a5381968173d26d676466e8331f9d81">00234</a> <span class="preprocessor"></span><span class="preprocessor">#define GET_B0()  B0 = I[x+dirs[b]]</span>
<a name="l00235"></a><a class="code" href="yape_8cpp.html#e24ef7b95466271eddaaf49ecf9de4d6">00235</a> <span class="preprocessor"></span><span class="preprocessor">#define GET_B1()  b++; B1 = I[x+dirs[b]]</span>
<a name="l00236"></a><a class="code" href="yape_8cpp.html#a4980f78044a594b896701ce08af4614">00236</a> <span class="preprocessor"></span><span class="preprocessor">#define GET_B2()  b++; B2 = I[x+dirs[b]]</span>
<a name="l00237"></a>00237 <span class="preprocessor"></span>
<a name="l00238"></a><a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">00238</a> <span class="preprocessor">#define GOTO_STATE(s)    { score -= A + B1; state = (s); break; }</span>
<a name="l00239"></a><a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">00239</a> <span class="preprocessor"></span><span class="preprocessor">#define GOTO_END_NOT_AN_INTEREST_POINT { </span><span class="comment">/*stats_iter[a]++;*/</span> Scores[x] = 0; return; }
<a name="l00240"></a><a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">00240</a> <span class="preprocessor">#define PUT_B2_IN_B1_AND_GET_B2()  B1 = B2; GET_B2()</span>
<a name="l00241"></a>00241 <span class="preprocessor"></span>
<a name="l00242"></a><a class="code" href="yape_8cpp.html#d374a5db2588531adad5a01c585fac74">00242</a> <span class="preprocessor">#define B1_NOT_INF_B2_NOT_INF  0</span>
<a name="l00243"></a><a class="code" href="yape_8cpp.html#ce9f6a1dc0aec3515fa24bc1abb00df6">00243</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_NOT_SUP_B2_NOT_SUP  1</span>
<a name="l00244"></a><a class="code" href="yape_8cpp.html#22e1ee2449b30ca0dcea869721e27568">00244</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_INF_B2_INF          2</span>
<a name="l00245"></a><a class="code" href="yape_8cpp.html#019cef3189fc91e2477e6ff48f9b696d">00245</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_SUP_B2_SUP          3</span>
<a name="l00246"></a><a class="code" href="yape_8cpp.html#e3c0b25fcd64689d1688a5c52e92e52d">00246</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_INF_B2_NOT_SUP      4</span>
<a name="l00247"></a><a class="code" href="yape_8cpp.html#8beb75c4b669eb89009671d8c69d0238">00247</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_SUP_B2_NOT_INF      5</span>
<a name="l00248"></a><a class="code" href="yape_8cpp.html#1ef436c15693204f3d9ee8c703a2b456">00248</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_SUP_B2_INF          6</span>
<a name="l00249"></a><a class="code" href="yape_8cpp.html#44b73b2fbb9e7e79b6f18a840b1b6e1a">00249</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_INF_B2_SUP          7</span>
<a name="l00250"></a><a class="code" href="yape_8cpp.html#9a85bcd548239759af1e26cd009c53a2">00250</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_EQUAL_B2_NOT_SUP    8</span>
<a name="l00251"></a><a class="code" href="yape_8cpp.html#4f8006a06b05f1d41631151581aaedce">00251</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_EQUAL_B2_NOT_INF    9</span>
<a name="l00252"></a>00252 <span class="preprocessor"></span>
<a name="l00253"></a><a class="code" href="classyape.html#55f0d32d90437ba7f0445caac2c18ac7">00253</a> <span class="keywordtype">void</span> <a class="code" href="classyape.html#55f0d32d90437ba7f0445caac2c18ac7">yape::perform_one_point</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * I, <span class="keyword">const</span> <span class="keywordtype">int</span> x, <span class="keywordtype">short</span> * Scores,
<a name="l00254"></a>00254                              <span class="keyword">const</span> <span class="keywordtype">int</span> Im, <span class="keyword">const</span> <span class="keywordtype">int</span> Ip, 
<a name="l00255"></a>00255                              <span class="keyword">const</span> <span class="keywordtype">short</span> * dirs, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> opposite, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> dirs_nb)
<a name="l00256"></a>00256 {
<a name="l00257"></a>00257   <span class="keywordtype">int</span> <a class="code" href="classyape.html#c4ce5a5ee7bc62a9df4298bdf1b789d8">score</a> = 0;
<a name="l00258"></a>00258   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="classyape.html#0fb49f3c030a765cbbeb2826110d78d8">a</a> = 0, <a class="code" href="classyape.html#bfd1bc19abfdd9b30f2ba2f766f287b3">b</a> = opposite - 1;
<a name="l00259"></a>00259   <span class="keywordtype">int</span> <a class="code" href="classyape.html#9c2d0562b689e085607be419841f8343">A</a>, <a class="code" href="classyape.html#49e38d3255a726caf04bb3edb00503c4">B0</a>, <a class="code" href="classyape.html#c51555bb80a842b21b261f21d99a2a26">B1</a>, <a class="code" href="classyape.html#97718a5093ac51a1edc9448b813f7111">B2</a>;
<a name="l00260"></a>00260   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="classyape.html#593e558c9bd630ccecab0b178c8c457f">state</a>;
<a name="l00261"></a>00261 
<a name="l00262"></a>00262   <span class="comment">// WE KNOW THAT NOT(A ~ I0 &amp; B1 ~ I0):</span>
<a name="l00263"></a>00263   <a class="code" href="yape_8cpp.html#a506ce31982f4c26691c029dffc6de5d">GET_A</a>();
<a name="l00264"></a>00264   <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#5a4ab9796ee659e8c7f1f7df6adce256">A_NOT_SUP</a>) {
<a name="l00265"></a>00265     <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#3b46aa7dff1682b1dde0b6939eee9db3">A_NOT_INF</a>) { <span class="comment">// A ~ I0</span>
<a name="l00266"></a>00266       <a class="code" href="yape_8cpp.html#6a5381968173d26d676466e8331f9d81">GET_B0</a>();
<a name="l00267"></a>00267       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#a62725bfe95c0b0351238e3e90e07389">B0_NOT_SUP</a>) {
<a name="l00268"></a>00268         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#db8df7e3e02c92bb61f6328d30d66d6f">B0_NOT_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00269"></a>00269         <span class="keywordflow">else</span> {
<a name="l00270"></a>00270           <a class="code" href="yape_8cpp.html#e24ef7b95466271eddaaf49ecf9de4d6">GET_B1</a>();
<a name="l00271"></a>00271           <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#1a960747725b5b58f3c75aabd61ece6f">B1_SUP</a>) {
<a name="l00272"></a>00272             <a class="code" href="yape_8cpp.html#a4980f78044a594b896701ce08af4614">GET_B2</a>();
<a name="l00273"></a>00273             <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) state = <a class="code" href="yape_8cpp.html#019cef3189fc91e2477e6ff48f9b696d">B1_SUP_B2_SUP</a>;
<a name="l00274"></a>00274             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) state = <a class="code" href="yape_8cpp.html#1ef436c15693204f3d9ee8c703a2b456">B1_SUP_B2_INF</a>;
<a name="l00275"></a>00275             <span class="keywordflow">else</span> <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a> <span class="comment">// A ~ I0, B2 ~ I0</span>
<a name="l00276"></a>00276           }
<a name="l00277"></a>00277           <span class="keywordflow">else</span><span class="comment">/* if (B1_INF)*/</span> {
<a name="l00278"></a>00278             <a class="code" href="yape_8cpp.html#a4980f78044a594b896701ce08af4614">GET_B2</a>();
<a name="l00279"></a>00279             <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) state = <a class="code" href="yape_8cpp.html#44b73b2fbb9e7e79b6f18a840b1b6e1a">B1_INF_B2_SUP</a>;
<a name="l00280"></a>00280             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) state = <a class="code" href="yape_8cpp.html#22e1ee2449b30ca0dcea869721e27568">B1_INF_B2_INF</a>;
<a name="l00281"></a>00281             <span class="keywordflow">else</span> <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a> <span class="comment">// A ~ I0, B2 ~ I0</span>
<a name="l00282"></a>00282           }
<a name="l00283"></a>00283           <span class="comment">//else GOTO_END_NOT_AN_INTEREST_POINT // A ~ I0, B1 ~ I0</span>
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285       }
<a name="l00286"></a>00286       <span class="keywordflow">else</span> { <span class="comment">// B0 &lt; I0</span>
<a name="l00287"></a>00287         <a class="code" href="yape_8cpp.html#e24ef7b95466271eddaaf49ecf9de4d6">GET_B1</a>();
<a name="l00288"></a>00288         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#1a960747725b5b58f3c75aabd61ece6f">B1_SUP</a>) {
<a name="l00289"></a>00289           <a class="code" href="yape_8cpp.html#a4980f78044a594b896701ce08af4614">GET_B2</a>();
<a name="l00290"></a>00290           <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) state = <a class="code" href="yape_8cpp.html#019cef3189fc91e2477e6ff48f9b696d">B1_SUP_B2_SUP</a>;
<a name="l00291"></a>00291           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) state = <a class="code" href="yape_8cpp.html#1ef436c15693204f3d9ee8c703a2b456">B1_SUP_B2_INF</a>;
<a name="l00292"></a>00292           <span class="keywordflow">else</span> <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a> <span class="comment">// A ~ I0, B2 ~ I0</span>
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#20f674e01986f34077be1d2162e595a3">B1_INF</a>) {
<a name="l00295"></a>00295           <a class="code" href="yape_8cpp.html#a4980f78044a594b896701ce08af4614">GET_B2</a>();
<a name="l00296"></a>00296           <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) state = <a class="code" href="yape_8cpp.html#44b73b2fbb9e7e79b6f18a840b1b6e1a">B1_INF_B2_SUP</a>;
<a name="l00297"></a>00297           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) state = <a class="code" href="yape_8cpp.html#22e1ee2449b30ca0dcea869721e27568">B1_INF_B2_INF</a>;
<a name="l00298"></a>00298           <span class="keywordflow">else</span> <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a> <span class="comment">// A ~ I0, B2 ~ I0</span>
<a name="l00299"></a>00299         }
<a name="l00300"></a>00300         <span class="keywordflow">else</span> <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a> <span class="comment">// A ~ I0, B1 ~ I0</span>
<a name="l00301"></a>00301       }
<a name="l00302"></a>00302     }
<a name="l00303"></a>00303     <span class="keywordflow">else</span> { <span class="comment">// A &gt; I0</span>
<a name="l00304"></a>00304       <a class="code" href="yape_8cpp.html#6a5381968173d26d676466e8331f9d81">GET_B0</a>();
<a name="l00305"></a>00305       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#f6507a01dc5603256e81e23760af4667">B0_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00306"></a>00306         <a class="code" href="yape_8cpp.html#e24ef7b95466271eddaaf49ecf9de4d6">GET_B1</a>();
<a name="l00307"></a>00307       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#1a960747725b5b58f3c75aabd61ece6f">B1_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00308"></a>00308         <a class="code" href="yape_8cpp.html#a4980f78044a594b896701ce08af4614">GET_B2</a>();
<a name="l00309"></a>00309       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00310"></a>00310         state = <a class="code" href="yape_8cpp.html#ce9f6a1dc0aec3515fa24bc1abb00df6">B1_NOT_SUP_B2_NOT_SUP</a>;
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312   }
<a name="l00313"></a>00313   <span class="keywordflow">else</span> <span class="comment">// A &lt; I0</span>
<a name="l00314"></a>00314   {
<a name="l00315"></a>00315     <a class="code" href="yape_8cpp.html#6a5381968173d26d676466e8331f9d81">GET_B0</a>();
<a name="l00316"></a>00316     <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#a65bd2ace10342db24134b9db1c06ccd">B0_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00317"></a>00317       <a class="code" href="yape_8cpp.html#e24ef7b95466271eddaaf49ecf9de4d6">GET_B1</a>();
<a name="l00318"></a>00318     <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#20f674e01986f34077be1d2162e595a3">B1_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00319"></a>00319       <a class="code" href="yape_8cpp.html#a4980f78044a594b896701ce08af4614">GET_B2</a>();
<a name="l00320"></a>00320     <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00321"></a>00321       state = <a class="code" href="yape_8cpp.html#d374a5db2588531adad5a01c585fac74">B1_NOT_INF_B2_NOT_INF</a>;
<a name="l00322"></a>00322   }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324   <span class="keywordflow">for</span>(a = 1; a &lt;= opposite; a++)
<a name="l00325"></a>00325   {
<a name="l00326"></a>00326     <a class="code" href="yape_8cpp.html#a506ce31982f4c26691c029dffc6de5d">GET_A</a>();
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     <span class="keywordflow">switch</span>(state)
<a name="l00329"></a>00329     {
<a name="l00330"></a>00330     <span class="keywordflow">case</span> <a class="code" href="yape_8cpp.html#d374a5db2588531adad5a01c585fac74">B1_NOT_INF_B2_NOT_INF</a>:
<a name="l00331"></a>00331       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#6283cd298b1f6f63a4c65452879c9f46">A_SUP</a>) {
<a name="l00332"></a>00332         <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00333"></a>00333         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00334"></a>00334           <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#d374a5db2588531adad5a01c585fac74">B1_NOT_INF_B2_NOT_INF</a>);
<a name="l00335"></a>00335       }
<a name="l00336"></a>00336       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d3341a57bfbb708756b3a44247debe99">A_INF</a>) {
<a name="l00337"></a>00337         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#1a960747725b5b58f3c75aabd61ece6f">B1_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00338"></a>00338           <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00339"></a>00339             <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00340"></a>00340         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00341"></a>00341           <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#9a85bcd548239759af1e26cd009c53a2">B1_EQUAL_B2_NOT_SUP</a>);
<a name="l00342"></a>00342       } 
<a name="l00343"></a>00343       <span class="comment">// A ~ I0</span>
<a name="l00344"></a>00344       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#ae552540150c061e1c93b099eb80356f">B1_NOT_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00345"></a>00345         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#c47b98b323797b3c210e0fd6fa43d9d8">B2_NOT_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00346"></a>00346           <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00347"></a>00347       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#019cef3189fc91e2477e6ff48f9b696d">B1_SUP_B2_SUP</a>);
<a name="l00348"></a>00348       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#1ef436c15693204f3d9ee8c703a2b456">B1_SUP_B2_INF</a>);
<a name="l00349"></a>00349       <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00350"></a>00350 
<a name="l00351"></a>00351     <span class="keywordflow">case</span> <a class="code" href="yape_8cpp.html#ce9f6a1dc0aec3515fa24bc1abb00df6">B1_NOT_SUP_B2_NOT_SUP</a>:
<a name="l00352"></a>00352       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d3341a57bfbb708756b3a44247debe99">A_INF</a>) {
<a name="l00353"></a>00353         <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00354"></a>00354         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00355"></a>00355           <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#ce9f6a1dc0aec3515fa24bc1abb00df6">B1_NOT_SUP_B2_NOT_SUP</a>);
<a name="l00356"></a>00356       }
<a name="l00357"></a>00357       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#6283cd298b1f6f63a4c65452879c9f46">A_SUP</a>) {
<a name="l00358"></a>00358         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#20f674e01986f34077be1d2162e595a3">B1_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00359"></a>00359           <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00360"></a>00360             <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00361"></a>00361         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00362"></a>00362           <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#4f8006a06b05f1d41631151581aaedce">B1_EQUAL_B2_NOT_INF</a>);
<a name="l00363"></a>00363       }
<a name="l00364"></a>00364       <span class="comment">// A ~ I0</span>
<a name="l00365"></a>00365       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b750a4bbf9096c134429f4d2ae5aebfa">B1_NOT_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00366"></a>00366         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#44e15b3c3c05eb56c8efb451ddeb739f">B2_NOT_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00367"></a>00367           <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00368"></a>00368       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#22e1ee2449b30ca0dcea869721e27568">B1_INF_B2_INF</a>);
<a name="l00369"></a>00369       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#44b73b2fbb9e7e79b6f18a840b1b6e1a">B1_INF_B2_SUP</a>);
<a name="l00370"></a>00370       <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     <span class="keywordflow">case</span> <a class="code" href="yape_8cpp.html#22e1ee2449b30ca0dcea869721e27568">B1_INF_B2_INF</a>:
<a name="l00373"></a>00373       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#6283cd298b1f6f63a4c65452879c9f46">A_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00374"></a>00374         <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00375"></a>00375       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d3341a57bfbb708756b3a44247debe99">A_INF</a>)
<a name="l00376"></a>00376       {
<a name="l00377"></a>00377         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00378"></a>00378           <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#e3c0b25fcd64689d1688a5c52e92e52d">B1_INF_B2_NOT_SUP</a>);
<a name="l00379"></a>00379       } 
<a name="l00380"></a>00380       <span class="comment">// A ~ I0</span>
<a name="l00381"></a>00381       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#44b73b2fbb9e7e79b6f18a840b1b6e1a">B1_INF_B2_SUP</a>);
<a name="l00382"></a>00382       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#22e1ee2449b30ca0dcea869721e27568">B1_INF_B2_INF</a>);
<a name="l00383"></a>00383       <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a> <span class="comment">// A ~ I0, B2 ~ I0</span>
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <span class="keywordflow">case</span> <a class="code" href="yape_8cpp.html#019cef3189fc91e2477e6ff48f9b696d">B1_SUP_B2_SUP</a>:
<a name="l00386"></a>00386       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d3341a57bfbb708756b3a44247debe99">A_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00387"></a>00387         <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00388"></a>00388       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#6283cd298b1f6f63a4c65452879c9f46">A_SUP</a>) {
<a name="l00389"></a>00389         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00390"></a>00390           <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#8beb75c4b669eb89009671d8c69d0238">B1_SUP_B2_NOT_INF</a>);
<a name="l00391"></a>00391       }
<a name="l00392"></a>00392       <span class="comment">// A ~ I0</span>
<a name="l00393"></a>00393       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#019cef3189fc91e2477e6ff48f9b696d">B1_SUP_B2_SUP</a>);
<a name="l00394"></a>00394       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#1ef436c15693204f3d9ee8c703a2b456">B1_SUP_B2_INF</a>);
<a name="l00395"></a>00395       <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     <span class="keywordflow">case</span> <a class="code" href="yape_8cpp.html#e3c0b25fcd64689d1688a5c52e92e52d">B1_INF_B2_NOT_SUP</a>:
<a name="l00398"></a>00398       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#6283cd298b1f6f63a4c65452879c9f46">A_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00399"></a>00399         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d3341a57bfbb708756b3a44247debe99">A_INF</a>) {
<a name="l00400"></a>00400           <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00401"></a>00401           <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00402"></a>00402             <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#ce9f6a1dc0aec3515fa24bc1abb00df6">B1_NOT_SUP_B2_NOT_SUP</a>);
<a name="l00403"></a>00403         }
<a name="l00404"></a>00404         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#44e15b3c3c05eb56c8efb451ddeb739f">B2_NOT_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00405"></a>00405           <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00406"></a>00406         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#22e1ee2449b30ca0dcea869721e27568">B1_INF_B2_INF</a>);
<a name="l00407"></a>00407         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#44b73b2fbb9e7e79b6f18a840b1b6e1a">B1_INF_B2_SUP</a>);
<a name="l00408"></a>00408         <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     <span class="keywordflow">case</span> <a class="code" href="yape_8cpp.html#8beb75c4b669eb89009671d8c69d0238">B1_SUP_B2_NOT_INF</a>:
<a name="l00411"></a>00411       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d3341a57bfbb708756b3a44247debe99">A_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00412"></a>00412         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#6283cd298b1f6f63a4c65452879c9f46">A_SUP</a>) {
<a name="l00413"></a>00413           <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00414"></a>00414           <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00415"></a>00415             <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#d374a5db2588531adad5a01c585fac74">B1_NOT_INF_B2_NOT_INF</a>);
<a name="l00416"></a>00416         }
<a name="l00417"></a>00417         <span class="comment">// A ~ I0</span>
<a name="l00418"></a>00418         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#c47b98b323797b3c210e0fd6fa43d9d8">B2_NOT_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00419"></a>00419           <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00420"></a>00420         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#019cef3189fc91e2477e6ff48f9b696d">B1_SUP_B2_SUP</a>);
<a name="l00421"></a>00421         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#1ef436c15693204f3d9ee8c703a2b456">B1_SUP_B2_INF</a>);
<a name="l00422"></a>00422         <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00423"></a>00423 
<a name="l00424"></a>00424     <span class="keywordflow">case</span> <a class="code" href="yape_8cpp.html#44b73b2fbb9e7e79b6f18a840b1b6e1a">B1_INF_B2_SUP</a>:
<a name="l00425"></a>00425       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#6283cd298b1f6f63a4c65452879c9f46">A_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00426"></a>00426         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d3341a57bfbb708756b3a44247debe99">A_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00427"></a>00427           <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00428"></a>00428       <span class="comment">// A ~ I0</span>
<a name="l00429"></a>00429       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#019cef3189fc91e2477e6ff48f9b696d">B1_SUP_B2_SUP</a>);
<a name="l00430"></a>00430       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#1ef436c15693204f3d9ee8c703a2b456">B1_SUP_B2_INF</a>);
<a name="l00431"></a>00431       <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a> <span class="comment">// A ~ I0, B2 ~ I0</span>
<a name="l00432"></a>00432 
<a name="l00433"></a>00433     <span class="keywordflow">case</span> <a class="code" href="yape_8cpp.html#1ef436c15693204f3d9ee8c703a2b456">B1_SUP_B2_INF</a>:
<a name="l00434"></a>00434       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#6283cd298b1f6f63a4c65452879c9f46">A_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00435"></a>00435         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d3341a57bfbb708756b3a44247debe99">A_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00436"></a>00436           <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00437"></a>00437       <span class="comment">// A ~ I0</span>
<a name="l00438"></a>00438       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#22e1ee2449b30ca0dcea869721e27568">B1_INF_B2_INF</a>);
<a name="l00439"></a>00439       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#44b73b2fbb9e7e79b6f18a840b1b6e1a">B1_INF_B2_SUP</a>);
<a name="l00440"></a>00440       <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a> <span class="comment">// A ~ I0, B2 ~ I0</span>
<a name="l00441"></a>00441 
<a name="l00442"></a>00442     <span class="keywordflow">case</span> <a class="code" href="yape_8cpp.html#9a85bcd548239759af1e26cd009c53a2">B1_EQUAL_B2_NOT_SUP</a>:
<a name="l00443"></a>00443       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#6283cd298b1f6f63a4c65452879c9f46">A_SUP</a>) {
<a name="l00444"></a>00444         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00445"></a>00445           <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00446"></a>00446         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00447"></a>00447           <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#4f8006a06b05f1d41631151581aaedce">B1_EQUAL_B2_NOT_INF</a>);
<a name="l00448"></a>00448       }
<a name="l00449"></a>00449       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d3341a57bfbb708756b3a44247debe99">A_INF</a>) {
<a name="l00450"></a>00450         <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00451"></a>00451         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00452"></a>00452           <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#ce9f6a1dc0aec3515fa24bc1abb00df6">B1_NOT_SUP_B2_NOT_SUP</a>);
<a name="l00453"></a>00453       }
<a name="l00454"></a>00454       <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00455"></a>00455 
<a name="l00456"></a>00456     <span class="keywordflow">case</span> <a class="code" href="yape_8cpp.html#4f8006a06b05f1d41631151581aaedce">B1_EQUAL_B2_NOT_INF</a>:
<a name="l00457"></a>00457       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d3341a57bfbb708756b3a44247debe99">A_INF</a>) {
<a name="l00458"></a>00458         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00459"></a>00459           <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00460"></a>00460         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#b7c9a171d048b0afa421bf9d4e7ecb0e">B2_SUP</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00461"></a>00461           <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#9a85bcd548239759af1e26cd009c53a2">B1_EQUAL_B2_NOT_SUP</a>);
<a name="l00462"></a>00462       }
<a name="l00463"></a>00463       <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#6283cd298b1f6f63a4c65452879c9f46">A_SUP</a>) {
<a name="l00464"></a>00464         <a class="code" href="yape_8cpp.html#0e82e10268d67c8dcee43438823a44a1">PUT_B2_IN_B1_AND_GET_B2</a>();
<a name="l00465"></a>00465         <span class="keywordflow">if</span> (<a class="code" href="yape_8cpp.html#d38642e924c0c099e7dbdc019d962c1d">B2_INF</a>) <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00466"></a>00466           <a class="code" href="yape_8cpp.html#663813fae4149977f975fa178c0e9936">GOTO_STATE</a>(<a class="code" href="yape_8cpp.html#d374a5db2588531adad5a01c585fac74">B1_NOT_INF_B2_NOT_INF</a>);
<a name="l00467"></a>00467       }
<a name="l00468"></a>00468       <a class="code" href="yape_8cpp.html#11119f8cdb13eb0106113e5c95c1cdfb">GOTO_END_NOT_AN_INTEREST_POINT</a>
<a name="l00469"></a>00469 
<a name="l00470"></a>00470     <span class="keywordflow">default</span>:
<a name="l00471"></a>00471       cout &lt;&lt; <span class="stringliteral">"PB default"</span> &lt;&lt; endl;
<a name="l00472"></a>00472     } <span class="comment">// switch(state)</span>
<a name="l00473"></a>00473   } <span class="comment">// for(a...)</span>
<a name="l00474"></a>00474 
<a name="l00475"></a>00475   Scores[x] = short(score + dirs_nb * I[x]);
<a name="l00476"></a>00476 }
<a name="l00477"></a>00477 
<a name="l00478"></a><a class="code" href="classyape.html#be06c02e6b77150ac03766158064e85d">00478</a> <span class="keywordtype">int</span> <a class="code" href="classyape.html#be06c02e6b77150ac03766158064e85d">yape::detect</a>(IplImage * <a class="code" href="artvertiser_8cpp.html#50c401d9f2e3a164c7d3dceb70b18771">image</a>, <a class="code" href="classkeypoint.html" title="A 2D feature point as detected by a point detector (yape for example).">keypoint</a> * points, <span class="keywordtype">int</span> max_point_number, IplImage * _filtered_image)
<a name="l00479"></a>00479 {
<a name="l00480"></a>00480   IplImage * used_filtered_image;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482   <span class="keywordflow">if</span> (_filtered_image == 0)
<a name="l00483"></a>00483   {
<a name="l00484"></a>00484     <span class="keywordtype">int</span> gaussian_filter_size = 3;
<a name="l00485"></a>00485 
<a name="l00486"></a>00486     <span class="keywordflow">if</span> (<a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a> &gt;= 5) gaussian_filter_size = 5;
<a name="l00487"></a>00487     <span class="keywordflow">if</span> (<a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a> &gt;= 7) gaussian_filter_size = 7;
<a name="l00488"></a>00488     cvSmooth(image, <a class="code" href="classyape.html#19e262558ad9f0f1273dca90f0f392e7">filtered_image</a>, CV_GAUSSIAN, gaussian_filter_size, gaussian_filter_size);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     used_filtered_image = <a class="code" href="classyape.html#19e262558ad9f0f1273dca90f0f392e7">filtered_image</a>;
<a name="l00491"></a>00491   }
<a name="l00492"></a>00492   <span class="keywordflow">else</span>
<a name="l00493"></a>00493     used_filtered_image = _filtered_image;
<a name="l00494"></a>00494 
<a name="l00495"></a>00495   <a class="code" href="classyape.html#52bc96b62aca4025bd6f1a3a4525cf6d">reserve_tmp_arrays</a>();
<a name="l00496"></a>00496 
<a name="l00497"></a>00497   <a class="code" href="classyape.html#e6308aa6b883f57a3fa7bd0c548d1d7a" title="detect interest points and add them to tmp_points.">raw_detect</a>(used_filtered_image);
<a name="l00498"></a>00498 
<a name="l00499"></a>00499   <a class="code" href="classyape.html#885bc853270ce86bba10f9617dbe0f2d">get_local_maxima</a>(image, <a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a>, 0);
<a name="l00500"></a>00500 
<a name="l00501"></a>00501   <span class="keywordtype">int</span> points_nb = <a class="code" href="classyape.html#f362d61fb20ed46554374d6288f23175" title="sort and select the max_point_number best features.">pick_best_points</a>(points, max_point_number);
<a name="l00502"></a>00502 
<a name="l00503"></a>00503   <span class="keywordflow">if</span> (<a class="code" href="classyape.html#50848a2a1e31c7d890af776e8d31a67b">use_subpixel</a>)
<a name="l00504"></a>00504     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; points_nb; i++) 
<a name="l00505"></a>00505       <a class="code" href="classyape.html#68311f372ad969d27228f0cd01e55310">subpix_refine</a>(used_filtered_image, points + i);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507   <span class="keywordflow">return</span> points_nb;
<a name="l00508"></a>00508 }
<a name="l00509"></a>00509 
<a name="l00510"></a><a class="code" href="yape_8cpp.html#042937f2b349cce59917b842afa69c89">00510</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="yape_8cpp.html#042937f2b349cce59917b842afa69c89">mymin</a>(<span class="keywordtype">unsigned</span> <a class="code" href="classyape.html#0fb49f3c030a765cbbeb2826110d78d8">a</a>, <span class="keywordtype">unsigned</span> <a class="code" href="classyape.html#bfd1bc19abfdd9b30f2ba2f766f287b3">b</a>)
<a name="l00511"></a>00511 {
<a name="l00512"></a>00512         <span class="keywordflow">return</span> (a&lt;b ? a:b);
<a name="l00513"></a>00513 }
<a name="l00514"></a>00514 
<a name="l00518"></a><a class="code" href="classyape.html#f362d61fb20ed46554374d6288f23175">00518</a> <span class="keywordtype">int</span> <a class="code" href="classyape.html#f362d61fb20ed46554374d6288f23175" title="sort and select the max_point_number best features.">yape::pick_best_points</a>(<a class="code" href="classkeypoint.html" title="A 2D feature point as detected by a point detector (yape for example).">keypoint</a> * points, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_point_number)
<a name="l00519"></a>00519 {
<a name="l00520"></a>00520   <span class="keywordflow">if</span> (<a class="code" href="classyape.html#598d88c4bec37b5a0d37309c65c9c518">use_bins</a>)
<a name="l00521"></a>00521   {
<a name="l00522"></a>00522     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="yape_8cpp.html#0240ac851181b84ac374872dc5434ee4">N</a> = 0;
<a name="l00523"></a>00523     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classyape.html#41d6681f3187bff4bdd6a6c5a9f2a89b">bin_nb_u</a>; i++)
<a name="l00524"></a>00524     {
<a name="l00525"></a>00525       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classyape.html#c96236772c47a4d05da4bce2760a3857">bin_nb_v</a>; j++)
<a name="l00526"></a>00526       {
<a name="l00527"></a>00527         <span class="keywordflow">if</span> (<a class="code" href="classyape.html#ce9a94d167d0edc352e5b1a4e9603834">bins</a>[i][j].size() &gt; 0){
<a name="l00528"></a>00528           sort(<a class="code" href="classyape.html#ce9a94d167d0edc352e5b1a4e9603834">bins</a>[i][j].begin(), <a class="code" href="classyape.html#ce9a94d167d0edc352e5b1a4e9603834">bins</a>[i][j].end());
<a name="l00529"></a>00529           N += <a class="code" href="classyape.html#ce9a94d167d0edc352e5b1a4e9603834">bins</a>[i][j].size();
<a name="l00530"></a>00530         }
<a name="l00531"></a>00531       }
<a name="l00532"></a>00532     }
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     N = max_point_number;
<a name="l00535"></a>00535     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> N_per_bin = N / (bin_nb_u * <a class="code" href="classyape.html#c96236772c47a4d05da4bce2760a3857">bin_nb_v</a>);
<a name="l00536"></a>00536     <span class="keywordtype">int</span> points_nb = 0;
<a name="l00537"></a>00537     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; bin_nb_u; i++)
<a name="l00538"></a>00538     {
<a name="l00539"></a>00539       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classyape.html#c96236772c47a4d05da4bce2760a3857">bin_nb_v</a>; j++)
<a name="l00540"></a>00540       {
<a name="l00541"></a>00541         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; <a class="code" href="yape_8cpp.html#042937f2b349cce59917b842afa69c89">mymin</a>(N_per_bin, <a class="code" href="classyape.html#ce9a94d167d0edc352e5b1a4e9603834">bins</a>[i][j].size()); k++, points_nb++)
<a name="l00542"></a>00542           points[points_nb] = <a class="code" href="classyape.html#ce9a94d167d0edc352e5b1a4e9603834">bins</a>[i][j][k];
<a name="l00543"></a>00543       }
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     <span class="keywordflow">return</span> points_nb;
<a name="l00547"></a>00547   }
<a name="l00548"></a>00548   <span class="keywordflow">else</span>
<a name="l00549"></a>00549     <span class="keywordflow">if</span> (<a class="code" href="classyape.html#7043625f249116e3258a0ff02829b479">tmp_points</a>.size() &gt; 0) 
<a name="l00550"></a>00550     {
<a name="l00551"></a>00551       sort(<a class="code" href="classyape.html#7043625f249116e3258a0ff02829b479">tmp_points</a>.begin(), <a class="code" href="classyape.html#7043625f249116e3258a0ff02829b479">tmp_points</a>.end());
<a name="l00552"></a>00552 
<a name="l00553"></a>00553       <span class="keywordtype">int</span> score_threshold = 0;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555       <span class="keywordtype">int</span> tot_pts = <a class="code" href="classyape.html#7043625f249116e3258a0ff02829b479">tmp_points</a>.size()&lt;max_point_number ? <a class="code" href="classyape.html#7043625f249116e3258a0ff02829b479">tmp_points</a>.size() : max_point_number;
<a name="l00556"></a>00556 
<a name="l00557"></a>00557       <span class="keywordtype">int</span> points_nb = 0;
<a name="l00558"></a>00558       <span class="keywordflow">for</span>(points_nb = 0; 
<a name="l00559"></a>00559         points_nb&lt;tot_pts &amp;&amp; <a class="code" href="classyape.html#7043625f249116e3258a0ff02829b479">tmp_points</a>[points_nb].score&gt;score_threshold; 
<a name="l00560"></a>00560         points_nb++)
<a name="l00561"></a>00561         points[points_nb] = <a class="code" href="classyape.html#7043625f249116e3258a0ff02829b479">tmp_points</a>[points_nb];
<a name="l00562"></a>00562 
<a name="l00563"></a>00563       <span class="keywordflow">return</span> points_nb;
<a name="l00564"></a>00564     }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <span class="keywordflow">return</span> 0;
<a name="l00567"></a>00567 }
<a name="l00568"></a>00568 
<a name="l00573"></a><a class="code" href="classyape.html#e6308aa6b883f57a3fa7bd0c548d1d7a">00573</a> <span class="keywordtype">void</span> <a class="code" href="classyape.html#e6308aa6b883f57a3fa7bd0c548d1d7a" title="detect interest points and add them to tmp_points.">yape::raw_detect</a>(IplImage *im) {
<a name="l00574"></a>00574   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> R = <a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a>;
<a name="l00575"></a>00575   <span class="keywordtype">short</span> * dirs = <a class="code" href="classyape.html#6a57527a8a0c8e41317549015a198cd8">Dirs</a>-&gt;<a class="code" href="structyape_1_1dir__table.html#18fe9092f27f50057891f62b6e4bf906">t</a>[R];
<a name="l00576"></a>00576   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> dirs_nb = (<span class="keywordtype">unsigned</span> char)(<a class="code" href="classyape.html#82e9bd81eb5cd0b077cc81059a744935">Dirs_nb</a>[R]);
<a name="l00577"></a>00577   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> opposite = dirs_nb / 2;
<a name="l00578"></a>00578 
<a name="l00579"></a>00579   CvRect roi = cvGetImageROI(im);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581   <span class="keywordflow">if</span> (roi.x &lt; <span class="keywordtype">int</span>(R+1)) roi.x = R+1;
<a name="l00582"></a>00582   <span class="keywordflow">if</span> (roi.y &lt; <span class="keywordtype">int</span>(R+1)) roi.y = R+1;
<a name="l00583"></a>00583   <span class="keywordflow">if</span> ((roi.x + roi.width)  &gt; <span class="keywordtype">int</span>(im-&gt;width-R-2))  roi.width  = im-&gt;width  - R - roi.x - 2;
<a name="l00584"></a>00584   <span class="keywordflow">if</span> ((roi.y + roi.height) &gt; <span class="keywordtype">int</span>(im-&gt;height-R-2)) roi.height = im-&gt;height - R - roi.y - 2;
<a name="l00585"></a>00585 
<a name="l00586"></a>00586   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xend = roi.x + roi.width;
<a name="l00587"></a>00587   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> yend = roi.y + roi.height;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y = roi.y; y &lt; yend; y++)
<a name="l00590"></a>00590   {
<a name="l00591"></a>00591     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * I = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(im-&gt;imageData + y*im-&gt;widthStep);
<a name="l00592"></a>00592     <span class="keywordtype">short</span> * Scores = (<span class="keywordtype">short</span> *)(<a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;imageData + y*<a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;widthStep);
<a name="l00593"></a>00593 
<a name="l00594"></a>00594     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x = roi.x; x &lt; xend; x++)
<a name="l00595"></a>00595     {
<a name="l00596"></a>00596       <span class="keywordtype">int</span> Ip = I[x] + <a class="code" href="classyape.html#e49f2128c475e1c7ca0b647d5602ebba">tau</a>;
<a name="l00597"></a>00597       <span class="keywordtype">int</span> Im = I[x] - tau;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599       <span class="keywordflow">if</span> (Im&lt;I[x+R] &amp;&amp; I[x+R]&lt;Ip &amp;&amp; Im&lt;I[x-R] &amp;&amp; I[x-R]&lt;Ip)
<a name="l00600"></a>00600         Scores[x] = 0;
<a name="l00601"></a>00601       <span class="keywordflow">else</span> 
<a name="l00602"></a>00602         <a class="code" href="classyape.html#55f0d32d90437ba7f0445caac2c18ac7">perform_one_point</a>(I, x, Scores, Im, Ip, dirs, opposite, dirs_nb);
<a name="l00603"></a>00603     }
<a name="l00604"></a>00604   }
<a name="l00605"></a>00605 }
<a name="l00606"></a>00606 
<a name="l00607"></a><a class="code" href="yape_8cpp.html#fba86a1166ab0647aeba1bd50192909a">00607</a> <span class="preprocessor">#define Dx 1</span>
<a name="l00608"></a><a class="code" href="yape_8cpp.html#c8be62ab4bb2ebd0e2771fff0d4319e1">00608</a> <span class="preprocessor"></span><span class="preprocessor">#define Dy next_line</span>
<a name="l00609"></a>00609 <span class="preprocessor"></span>
<a name="l00610"></a><a class="code" href="yape_8cpp.html#649b8f01fd6c0f47ff3cbddaeba63bfb">00610</a> <span class="preprocessor">#define W (-Dx)</span>
<a name="l00611"></a><a class="code" href="yape_8cpp.html#07484107e6d9fdf38b53edf631d6511d">00611</a> <span class="preprocessor"></span><span class="preprocessor">#define E (+Dx)</span>
<a name="l00612"></a><a class="code" href="yape_8cpp.html#0240ac851181b84ac374872dc5434ee4">00612</a> <span class="preprocessor"></span><span class="preprocessor">#define N (-Dy)</span>
<a name="l00613"></a><a class="code" href="yape_8cpp.html#f933676109efed7ab34cea71d748a517">00613</a> <span class="preprocessor"></span><span class="preprocessor">#define S (+Dy)</span>
<a name="l00614"></a>00614 <span class="preprocessor"></span>
<a name="l00615"></a><a class="code" href="yape_8cpp.html#c9e75c493dae03fd2740f792f07b37d2">00615</a> <span class="preprocessor">#define MINIMAL_SCORE (0 / radius)</span>
<a name="l00616"></a>00616 <span class="preprocessor"></span>
<a name="l00617"></a><a class="code" href="classyape.html#0a8b33901efe60a647c7ad66587f99a6">00617</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classyape.html#0a8b33901efe60a647c7ad66587f99a6">yape::third_check</a>(<span class="keyword">const</span> <span class="keywordtype">short</span> * Sb, <span class="keyword">const</span> <span class="keywordtype">int</span> next_line)
<a name="l00618"></a>00618 {
<a name="l00619"></a>00619   <span class="keywordtype">int</span> n = 0;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621   <span class="keywordflow">if</span> (Sb[<a class="code" href="yape_8cpp.html#07484107e6d9fdf38b53edf631d6511d">E</a>]   != 0) n++;
<a name="l00622"></a>00622   <span class="keywordflow">if</span> (Sb[<a class="code" href="yape_8cpp.html#649b8f01fd6c0f47ff3cbddaeba63bfb">W</a>]   != 0) n++;
<a name="l00623"></a>00623   <span class="keywordflow">if</span> (Sb[<a class="code" href="yape_8cpp.html#f933676109efed7ab34cea71d748a517">S</a>]   != 0) n++;
<a name="l00624"></a>00624   <span class="keywordflow">if</span> (Sb[<a class="code" href="yape_8cpp.html#f933676109efed7ab34cea71d748a517">S</a>+<a class="code" href="yape_8cpp.html#07484107e6d9fdf38b53edf631d6511d">E</a>] != 0) n++;
<a name="l00625"></a>00625   <span class="keywordflow">if</span> (Sb[<a class="code" href="yape_8cpp.html#f933676109efed7ab34cea71d748a517">S</a>+<a class="code" href="yape_8cpp.html#649b8f01fd6c0f47ff3cbddaeba63bfb">W</a>] != 0) n++;
<a name="l00626"></a>00626   <span class="keywordflow">if</span> (Sb[<a class="code" href="yape_8cpp.html#0240ac851181b84ac374872dc5434ee4">N</a>]   != 0) n++;
<a name="l00627"></a>00627   <span class="keywordflow">if</span> (Sb[<a class="code" href="yape_8cpp.html#0240ac851181b84ac374872dc5434ee4">N</a>+<a class="code" href="yape_8cpp.html#07484107e6d9fdf38b53edf631d6511d">E</a>] != 0) n++;
<a name="l00628"></a>00628   <span class="keywordflow">if</span> (Sb[<a class="code" href="yape_8cpp.html#0240ac851181b84ac374872dc5434ee4">N</a>+<a class="code" href="yape_8cpp.html#649b8f01fd6c0f47ff3cbddaeba63bfb">W</a>] != 0) n++;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630   <span class="keywordflow">return</span> n &gt;= <a class="code" href="classyape.html#f35b3d8b6630041fd41e67ca584e55bb">minimal_neighbor_number</a>;
<a name="l00631"></a>00631 }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633 <span class="comment">// Test if a pixel is a local maxima in a given neighborhood.</span>
<a name="l00634"></a><a class="code" href="yape_8cpp.html#696b7fdfea923e343fe7cd773495ac07">00634</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="yape_8cpp.html#696b7fdfea923e343fe7cd773495ac07">is_local_maxima</a>(<span class="keyword">const</span> <span class="keywordtype">short</span> *p, <span class="keywordtype">int</span> neighborhood, <span class="keyword">const</span> IplImage *<a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>)
<a name="l00635"></a>00635 {
<a name="l00636"></a>00636 <span class="preprocessor">#ifdef CONSIDER_ABS_VALUE_ONLY</span>
<a name="l00637"></a>00637 <span class="preprocessor"></span>  <span class="keywordtype">unsigned</span> v = abs(p[0]);
<a name="l00638"></a>00638   <span class="keywordflow">if</span> (v &lt; 5) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00639"></a>00639 
<a name="l00640"></a>00640   <span class="keywordtype">int</span> step = scores-&gt;widthStep / 2;
<a name="l00641"></a>00641 
<a name="l00642"></a>00642   p -= step*neighborhood;
<a name="l00643"></a>00643   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y= -neighborhood; y&lt;=neighborhood; ++y) {
<a name="l00644"></a>00644     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x= -neighborhood; x&lt;=neighborhood; ++x) {
<a name="l00645"></a>00645       <span class="keywordflow">if</span> (abs(p[x]) &gt; v)
<a name="l00646"></a>00646         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00647"></a>00647     }
<a name="l00648"></a>00648     p += step;
<a name="l00649"></a>00649   }
<a name="l00650"></a>00650   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00651"></a>00651 <span class="preprocessor">#else</span>
<a name="l00652"></a>00652 <span class="preprocessor"></span>  <span class="keywordtype">int</span> v = p[0];
<a name="l00653"></a>00653 
<a name="l00654"></a>00654   <span class="keywordtype">int</span> step = scores-&gt;widthStep / 2;
<a name="l00655"></a>00655 
<a name="l00656"></a>00656   <span class="keywordflow">if</span> (v &gt; 0) {
<a name="l00657"></a>00657     p -= step*neighborhood;
<a name="l00658"></a>00658     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y= -neighborhood; y&lt;=neighborhood; ++y) {
<a name="l00659"></a>00659       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x= -neighborhood; x&lt;=neighborhood; ++x) {
<a name="l00660"></a>00660         <span class="keywordflow">if</span> (p[x] &gt; v)
<a name="l00661"></a>00661           <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00662"></a>00662       }
<a name="l00663"></a>00663       p += step;
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665   } <span class="keywordflow">else</span> {
<a name="l00666"></a>00666     p -= step*neighborhood;
<a name="l00667"></a>00667     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y= -neighborhood; y&lt;=neighborhood; ++y) {
<a name="l00668"></a>00668       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x= -neighborhood; x&lt;=neighborhood; ++x) {
<a name="l00669"></a>00669         <span class="keywordflow">if</span> (p[x] &lt; v)
<a name="l00670"></a>00670           <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00671"></a>00671       }
<a name="l00672"></a>00672       p += step;
<a name="l00673"></a>00673     }
<a name="l00674"></a>00674   }
<a name="l00675"></a>00675 
<a name="l00676"></a>00676   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00677"></a>00677 
<a name="l00678"></a>00678 <span class="preprocessor">#endif</span>
<a name="l00679"></a>00679 <span class="preprocessor"></span>}
<a name="l00680"></a>00680 
<a name="l00684"></a><a class="code" href="classyape.html#885bc853270ce86bba10f9617dbe0f2d">00684</a> <span class="keywordtype">int</span> <a class="code" href="classyape.html#885bc853270ce86bba10f9617dbe0f2d">yape::get_local_maxima</a>(IplImage * <a class="code" href="artvertiser_8cpp.html#50c401d9f2e3a164c7d3dceb70b18771">image</a>, <span class="keywordtype">int</span> R, <span class="keywordtype">float</span> scale <span class="comment">/*, keypoint * points, int max_number_of_points*/</span>)
<a name="l00685"></a>00685 {
<a name="l00686"></a>00686   <span class="keywordtype">int</span> nbpts=0;
<a name="l00687"></a>00687 
<a name="l00688"></a>00688   <span class="keyword">const</span> <span class="keywordtype">int</span> next_line = <a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;widthStep / <span class="keyword">sizeof</span>(short);
<a name="l00689"></a>00689   <span class="keywordtype">int</span> h = <a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;height;
<a name="l00690"></a>00690   <span class="keywordtype">int</span> w = <a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;width;
<a name="l00691"></a>00691 
<a name="l00692"></a>00692   CvRect roi = cvGetImageROI(image);
<a name="l00693"></a>00693 
<a name="l00694"></a>00694   <span class="keywordflow">if</span> (roi.x &lt; <span class="keywordtype">int</span>(R+1)) roi.x = R+1;
<a name="l00695"></a>00695   <span class="keywordflow">if</span> (roi.y &lt; <span class="keywordtype">int</span>(R+1)) roi.y = R+1;
<a name="l00696"></a>00696   <span class="keywordflow">if</span> ((roi.x + roi.width)  &gt; <span class="keywordtype">int</span>(<a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;width-R-2))  roi.width  = <a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;width  - R - roi.x - 2;
<a name="l00697"></a>00697   <span class="keywordflow">if</span> ((roi.y + roi.height) &gt; <span class="keywordtype">int</span>(<a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;height-R-2)) roi.height = <a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;height - R - roi.y - 2;
<a name="l00698"></a>00698 
<a name="l00699"></a>00699   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xend = roi.x + roi.width;
<a name="l00700"></a>00700   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> yend = roi.y + roi.height;
<a name="l00701"></a>00701 
<a name="l00702"></a>00702   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y = roi.y; y &lt; yend; y++)
<a name="l00703"></a>00703   {
<a name="l00704"></a>00704     <span class="keywordtype">short</span> * Scores = (<span class="keywordtype">short</span> *)(<a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;imageData + y * <a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;widthStep);
<a name="l00705"></a>00705 
<a name="l00706"></a>00706     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x = roi.x; x &lt; xend; x++)
<a name="l00707"></a>00707     {
<a name="l00708"></a>00708       <span class="keywordtype">short</span> * Sb = Scores + x;
<a name="l00709"></a>00709 
<a name="l00710"></a>00710       <span class="comment">// skip 0 score pixels</span>
<a name="l00711"></a>00711       <span class="keywordflow">if</span> (abs(Sb[0]) &lt; 5)
<a name="l00712"></a>00712         ++x; <span class="comment">// if this pixel is 0, the next one will not be good enough. Skip it.</span>
<a name="l00713"></a>00713       <span class="keywordflow">else</span> 
<a name="l00714"></a>00714       {
<a name="l00715"></a>00715         <span class="keywordflow">if</span> (<a class="code" href="classyape.html#0a8b33901efe60a647c7ad66587f99a6">third_check</a>(Sb, next_line) &amp;&amp; <a class="code" href="yape_8cpp.html#696b7fdfea923e343fe7cd773495ac07">is_local_maxima</a>(Sb, R, <a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>))
<a name="l00716"></a>00716         {
<a name="l00717"></a>00717           <a class="code" href="classkeypoint.html" title="A 2D feature point as detected by a point detector (yape for example).">keypoint</a> p;
<a name="l00718"></a>00718           p.<a class="code" href="classkeypoint.html#33c3ab391ee9e7674facb185044a6d85">u</a> = float(x);
<a name="l00719"></a>00719           p.<a class="code" href="classkeypoint.html#cd0c67d60635b82c24b0ab52ff65d820" title="2D coordinates of the point">v</a> = float(y);
<a name="l00720"></a>00720           p.<a class="code" href="classkeypoint.html#5cd322f1a3dbc35a2aae60a67f27b29b" title="point scale">scale</a> = scale;
<a name="l00721"></a>00721           p.<a class="code" href="classkeypoint.html#33bd514940806485e3c8c03233f6d613" title="higher is the score, stronger is the point">score</a> = float(abs(Sb[0]));
<a name="l00722"></a>00722 
<a name="l00723"></a>00723           <span class="keywordflow">if</span> (<a class="code" href="classyape.html#598d88c4bec37b5a0d37309c65c9c518">use_bins</a>)
<a name="l00724"></a>00724           {
<a name="l00725"></a>00725             <span class="keywordtype">int</span> bin_u_index = (<a class="code" href="classyape.html#41d6681f3187bff4bdd6a6c5a9f2a89b">bin_nb_u</a> * x) / w;
<a name="l00726"></a>00726             <span class="keywordtype">int</span> bin_v_index = (<a class="code" href="classyape.html#c96236772c47a4d05da4bce2760a3857">bin_nb_v</a> * y) / h;
<a name="l00727"></a>00727 
<a name="l00728"></a>00728             <span class="keywordflow">if</span> (bin_u_index &gt;= <a class="code" href="classyape.html#41d6681f3187bff4bdd6a6c5a9f2a89b">bin_nb_u</a>)
<a name="l00729"></a>00729               bin_u_index = <a class="code" href="classyape.html#41d6681f3187bff4bdd6a6c5a9f2a89b">bin_nb_u</a> - 1;
<a name="l00730"></a>00730             <span class="keywordflow">if</span> (bin_v_index &gt;= <a class="code" href="classyape.html#c96236772c47a4d05da4bce2760a3857">bin_nb_v</a>)
<a name="l00731"></a>00731               bin_v_index = <a class="code" href="classyape.html#c96236772c47a4d05da4bce2760a3857">bin_nb_v</a> - 1;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733             <span class="keywordflow">if</span> (<a class="code" href="classyape.html#ce9a94d167d0edc352e5b1a4e9603834">bins</a>[bin_u_index][bin_v_index].size() &lt; <a class="code" href="yape_8cpp.html#d7ccb0601e65529846417fff785105cd">yape_bin_size</a>)
<a name="l00734"></a>00734               <a class="code" href="classyape.html#ce9a94d167d0edc352e5b1a4e9603834">bins</a>[bin_u_index][bin_v_index].push_back(p);
<a name="l00735"></a>00735           }
<a name="l00736"></a>00736           <span class="keywordflow">else</span>
<a name="l00737"></a>00737             <a class="code" href="classyape.html#7043625f249116e3258a0ff02829b479">tmp_points</a>.push_back(p);
<a name="l00738"></a>00738 
<a name="l00739"></a>00739           nbpts++;
<a name="l00740"></a>00740           x += R-1;
<a name="l00741"></a>00741         }
<a name="l00742"></a>00742       }
<a name="l00743"></a>00743     }
<a name="l00744"></a>00744   }
<a name="l00745"></a>00745   <span class="keywordflow">return</span> nbpts;
<a name="l00746"></a>00746 }
<a name="l00747"></a>00747 
<a name="l00749"></a>00749 <span class="comment">// Sub-pixel / sub-scale accuracy.</span>
<a name="l00751"></a>00751 <span class="comment"></span>
<a name="l00752"></a><a class="code" href="yape_8cpp.html#f34514da79c418227416c245758dc6ed">00752</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="yape_8cpp.html#f34514da79c418227416c245758dc6ed">fit_quadratic_2x2</a>(<span class="keywordtype">float</span> x[2], <span class="keywordtype">float</span> L[3][3])
<a name="l00753"></a>00753 {
<a name="l00754"></a>00754   <span class="keywordtype">float</span> <a class="code" href="classyape.html#4260d54eca2a006b5a0440d790bfdfb6">H</a>[2][2];
<a name="l00755"></a>00755   <span class="keywordtype">float</span> <a class="code" href="classyape.html#bfd1bc19abfdd9b30f2ba2f766f287b3">b</a>[2];
<a name="l00756"></a>00756 
<a name="l00757"></a>00757   b[0] = -(L[1][2] - L[1][0]) / 2.0f;
<a name="l00758"></a>00758   b[1] = -(L[2][1] - L[0][1]) / 2.0f;
<a name="l00759"></a>00759 
<a name="l00760"></a>00760   H[0][0] = L[1][0] - 2.0f * L[1][1] + L[1][2];
<a name="l00761"></a>00761   H[1][1] = L[0][1] - 2.0f * L[1][1] + L[2][1];
<a name="l00762"></a>00762   H[0][1] = H[1][0] = (L[0][0] - L[0][2] - L[2][0] + L[2][2]) / 4.0f;
<a name="l00763"></a>00763 
<a name="l00764"></a>00764   <span class="keywordtype">float</span> t4 = 1/(H[0][0]*H[1][1]-H[0][1]*H[1][0]);
<a name="l00765"></a>00765   x[0] =  H[1][1]*t4*b[0]-H[0][1]*t4*b[1];
<a name="l00766"></a>00766   x[1] = -H[1][0]*t4*b[0]+H[0][0]*t4*b[1];
<a name="l00767"></a>00767 
<a name="l00768"></a>00768   <span class="keywordflow">return</span> 0.5f * (b[0] * x[0] + b[1] * x[1]);
<a name="l00769"></a>00769 }
<a name="l00770"></a>00770 
<a name="l00771"></a><a class="code" href="classyape.html#68311f372ad969d27228f0cd01e55310">00771</a> <span class="keywordtype">void</span> <a class="code" href="classyape.html#68311f372ad969d27228f0cd01e55310">yape::subpix_refine</a>(IplImage *im, <a class="code" href="classkeypoint.html" title="A 2D feature point as detected by a point detector (yape for example).">keypoint</a> *p)
<a name="l00772"></a>00772 {
<a name="l00773"></a>00773   <span class="keywordtype">float</span> L[3][3];
<a name="l00774"></a>00774 
<a name="l00775"></a>00775   <span class="keywordtype">int</span> px = (int) p-&gt;<a class="code" href="classkeypoint.html#33c3ab391ee9e7674facb185044a6d85">u</a>;
<a name="l00776"></a>00776   <span class="keywordtype">int</span> py = (<span class="keywordtype">int</span>) p-&gt;<a class="code" href="classkeypoint.html#cd0c67d60635b82c24b0ab52ff65d820" title="2D coordinates of the point">v</a>;
<a name="l00777"></a>00777   <span class="keywordtype">int</span> dirs_nb = <a class="code" href="classyape.html#82e9bd81eb5cd0b077cc81059a744935">Dirs_nb</a>[<a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a>];
<a name="l00778"></a>00778   <span class="keywordtype">short</span> * dirs = <a class="code" href="classyape.html#6a57527a8a0c8e41317549015a198cd8">Dirs</a>-&gt;<a class="code" href="structyape_1_1dir__table.html#18fe9092f27f50057891f62b6e4bf906">t</a>[<a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a>];
<a name="l00779"></a>00779 
<a name="l00780"></a>00780   <span class="keywordflow">if</span> ((px&lt;= <a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a>) || (px &gt;= (<a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;width-<a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a>)) || (py &lt;= radius) || (py &gt;= (<a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;height-<a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a>)))
<a name="l00781"></a>00781     <span class="keywordflow">return</span>;
<a name="l00782"></a>00782 
<a name="l00783"></a>00783   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * I = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) (im-&gt;imageData + py*im-&gt;widthStep) +  px;
<a name="l00784"></a>00784   <span class="keywordtype">short</span> * s = (<span class="keywordtype">short</span> *) (<a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;imageData + py*<a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;widthStep) +  px;
<a name="l00785"></a>00785   <span class="keywordtype">int</span> line = <a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>-&gt;widthStep/<span class="keyword">sizeof</span>(short);
<a name="l00786"></a>00786 
<a name="l00787"></a>00787   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0; y&lt;3; ++y) {
<a name="l00788"></a>00788     <span class="keywordtype">int</span> offset = (y-1)*line - 1;
<a name="l00789"></a>00789     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;3; ++x) {
<a name="l00790"></a>00790       <span class="keywordflow">if</span> (s[ offset + x]==0) {
<a name="l00791"></a>00791         <span class="comment">// Compute Laplacian</span>
<a name="l00792"></a>00792         <span class="keywordtype">int</span> <a class="code" href="classyape.html#c4ce5a5ee7bc62a9df4298bdf1b789d8">score</a> = 0;
<a name="l00793"></a>00793         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d=0; d&lt;dirs_nb; ++d)
<a name="l00794"></a>00794           score += I[offset + x + dirs[d]];
<a name="l00795"></a>00795         L[y][x] = -float(score - dirs_nb*(<span class="keywordtype">int</span>)I[offset + x]);
<a name="l00796"></a>00796       } <span class="keywordflow">else</span> {
<a name="l00797"></a>00797         L[y][x] = (float)s[ offset + x];
<a name="l00798"></a>00798       }
<a name="l00799"></a>00799     }
<a name="l00800"></a>00800   }
<a name="l00801"></a>00801 
<a name="l00802"></a>00802   <span class="keywordtype">float</span> delta[2];
<a name="l00803"></a>00803   p-&gt;<a class="code" href="classkeypoint.html#33bd514940806485e3c8c03233f6d613" title="higher is the score, stronger is the point">score</a> += <a class="code" href="yape_8cpp.html#f34514da79c418227416c245758dc6ed">fit_quadratic_2x2</a>(delta, L);
<a name="l00804"></a>00804 
<a name="l00805"></a>00805   <span class="keywordflow">if</span> ((delta[0] &gt;= -1) &amp;&amp; (delta[0] &lt;= 1))
<a name="l00806"></a>00806     p-&gt;<a class="code" href="classkeypoint.html#33c3ab391ee9e7674facb185044a6d85">u</a> += delta[0];
<a name="l00807"></a>00807   <span class="keywordflow">else</span> 
<a name="l00808"></a>00808     p-&gt;<a class="code" href="classkeypoint.html#33c3ab391ee9e7674facb185044a6d85">u</a>+=0.5f;
<a name="l00809"></a>00809   <span class="keywordflow">if</span> ((delta[1] &gt;= -1) &amp;&amp; (delta[1] &lt;= 1))
<a name="l00810"></a>00810     p-&gt;<a class="code" href="classkeypoint.html#cd0c67d60635b82c24b0ab52ff65d820" title="2D coordinates of the point">v</a> += delta[1];
<a name="l00811"></a>00811   <span class="keywordflow">else</span> 
<a name="l00812"></a>00812     p-&gt;<a class="code" href="classkeypoint.html#cd0c67d60635b82c24b0ab52ff65d820" title="2D coordinates of the point">v</a>+=0.5f;
<a name="l00813"></a>00813 }
<a name="l00814"></a>00814 
<a name="l00816"></a>00816 <span class="comment">// PyrYape implementation</span>
<a name="l00818"></a>00818 <span class="comment"></span>
<a name="l00823"></a><a class="code" href="classpyr__yape.html#850481cc73f6c0282047945b3925e787">00823</a> <a class="code" href="classpyr__yape.html#850481cc73f6c0282047945b3925e787">pyr_yape::pyr_yape</a>(<span class="keywordtype">int</span> w, <span class="keywordtype">int</span> h, <span class="keywordtype">int</span> nbLev) 
<a name="l00824"></a>00824 : <a class="code" href="classyape.html" title="YAPE feature point detector.">yape</a> (w,h)
<a name="l00825"></a>00825 {
<a name="l00826"></a>00826   <a class="code" href="classpyr__yape.html#b812538a04a4586cb4d04d75ab193f1f">internal_pim</a> = 0;
<a name="l00827"></a>00827   <a class="code" href="classpyr__yape.html#4ca91e38c164e6afcf1f40e3e0dcbacb">pscores</a> = <span class="keyword">new</span> <a class="code" href="classPyrImage.html" title="Multi-resolution pyramidal image.">PyrImage</a>(<a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a>, nbLev);
<a name="l00828"></a>00828   <a class="code" href="classpyr__yape.html#a115117ab1af1f6f1d251c0bf1584e68">pDirs</a>[0] = <a class="code" href="classyape.html#6a57527a8a0c8e41317549015a198cd8">Dirs</a>;
<a name="l00829"></a>00829   <a class="code" href="classpyr__yape.html#8fd9eace87fa04b59cb2ae362df9f3a4">pDirs_nb</a>[0] = <a class="code" href="classyape.html#82e9bd81eb5cd0b077cc81059a744935">Dirs_nb</a>;
<a name="l00830"></a>00830   <a class="code" href="classpyr__yape.html#b505183795c219c54f2f92bf70970868" title="Limit the maximum number of detected keypoint per level.">equalize</a> = <span class="keyword">false</span>;
<a name="l00831"></a>00831 
<a name="l00832"></a>00832   <a class="code" href="classPyrImage.html" title="Multi-resolution pyramidal image.">PyrImage</a> pim(cvCreateImage(cvSize(w, h), IPL_DEPTH_8U, 1),nbLev);
<a name="l00833"></a>00833 
<a name="l00834"></a>00834   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;nbLev; i++) {
<a name="l00835"></a>00835     <a class="code" href="classpyr__yape.html#a115117ab1af1f6f1d251c0bf1584e68">pDirs</a>[i] = <span class="keyword">new</span> <a class="code" href="structyape_1_1dir__table.html">dir_table</a>;
<a name="l00836"></a>00836     <a class="code" href="classpyr__yape.html#8fd9eace87fa04b59cb2ae362df9f3a4">pDirs_nb</a>[i] = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="yape_8h.html#874c06fd995c35f62a4c77c64b880164">yape_max_radius</a>];
<a name="l00837"></a>00837     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> R = 1; R &lt; <a class="code" href="yape_8h.html#874c06fd995c35f62a4c77c64b880164">yape_max_radius</a>; R++)
<a name="l00838"></a>00838       <a class="code" href="classyape.html#170b352e90f4f55e1ac5b5a87aa801f6">precompute_directions</a>(pim[i], <a class="code" href="classpyr__yape.html#a115117ab1af1f6f1d251c0bf1584e68">pDirs</a>[i]-&gt;t[R], &amp;(<a class="code" href="classpyr__yape.html#8fd9eace87fa04b59cb2ae362df9f3a4">pDirs_nb</a>[i][R]), R);
<a name="l00839"></a>00839   }
<a name="l00840"></a>00840 }
<a name="l00841"></a>00841 
<a name="l00842"></a><a class="code" href="classpyr__yape.html#9aff9c35997e352d8a5ef9a46e5750a0">00842</a> <a class="code" href="classpyr__yape.html#9aff9c35997e352d8a5ef9a46e5750a0">pyr_yape::~pyr_yape</a>() 
<a name="l00843"></a>00843 {
<a name="l00844"></a>00844   <span class="keywordflow">if</span> (<a class="code" href="classpyr__yape.html#b812538a04a4586cb4d04d75ab193f1f">internal_pim</a>) <span class="keyword">delete</span> <a class="code" href="classpyr__yape.html#b812538a04a4586cb4d04d75ab193f1f">internal_pim</a>;
<a name="l00845"></a>00845 
<a name="l00846"></a>00846   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classpyr__yape.html#4ca91e38c164e6afcf1f40e3e0dcbacb">pscores</a>-&gt;<a class="code" href="classPyrImage.html#bed0e465ecbeac3fba64d1370109ba7a">nbLev</a>; i++) {
<a name="l00847"></a>00847     <span class="keyword">delete</span> <a class="code" href="classpyr__yape.html#a115117ab1af1f6f1d251c0bf1584e68">pDirs</a>[i];
<a name="l00848"></a>00848     <span class="keyword">delete</span>[] <a class="code" href="classpyr__yape.html#8fd9eace87fa04b59cb2ae362df9f3a4">pDirs_nb</a>[i];
<a name="l00849"></a>00849   }
<a name="l00850"></a>00850   <a class="code" href="classyape.html#6a57527a8a0c8e41317549015a198cd8">Dirs</a>=0;
<a name="l00851"></a>00851   <a class="code" href="classyape.html#82e9bd81eb5cd0b077cc81059a744935">Dirs_nb</a>=0;
<a name="l00852"></a>00852   <span class="keyword">delete</span> <a class="code" href="classpyr__yape.html#4ca91e38c164e6afcf1f40e3e0dcbacb">pscores</a>;
<a name="l00853"></a>00853   <a class="code" href="classpyr__yape.html#4ca91e38c164e6afcf1f40e3e0dcbacb">pscores</a> = 0;
<a name="l00854"></a>00854   <a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a> = 0;
<a name="l00855"></a>00855 }
<a name="l00856"></a>00856 
<a name="l00857"></a><a class="code" href="classpyr__yape.html#c0ff6d645029953f0e4a1e18d04ce208">00857</a> <span class="keywordtype">void</span> <a class="code" href="classpyr__yape.html#c0ff6d645029953f0e4a1e18d04ce208">pyr_yape::select_level</a>(<span class="keywordtype">int</span> l)
<a name="l00858"></a>00858 {
<a name="l00859"></a>00859   <a class="code" href="classyape.html#b3468550e58146f30223abdd05e0b70f">scores</a> = <a class="code" href="classpyr__yape.html#4ca91e38c164e6afcf1f40e3e0dcbacb">pscores</a>-&gt;<a class="code" href="classPyrImage.html#193d0624ee9ace7dc4f09d8e5188e1da">images</a>[l];
<a name="l00860"></a>00860   <a class="code" href="classyape.html#6a57527a8a0c8e41317549015a198cd8">Dirs</a> = <a class="code" href="classpyr__yape.html#a115117ab1af1f6f1d251c0bf1584e68">pDirs</a>[l];
<a name="l00861"></a>00861   <a class="code" href="classyape.html#82e9bd81eb5cd0b077cc81059a744935">Dirs_nb</a> = <a class="code" href="classpyr__yape.html#8fd9eace87fa04b59cb2ae362df9f3a4">pDirs_nb</a>[l];
<a name="l00862"></a>00862 }
<a name="l00863"></a>00863 
<a name="l00867"></a><a class="code" href="classpyr__yape.html#7aafe8bbfa0774664a61a9528c73ed3c">00867</a> <span class="keywordtype">int</span> <a class="code" href="classpyr__yape.html#69e1c1bd2b024079637fd5328471cfb1" title="Call pyramidBlurDetect():.">pyr_yape::detect</a>(<a class="code" href="classPyrImage.html" title="Multi-resolution pyramidal image.">PyrImage</a> *<a class="code" href="artvertiser_8cpp.html#50c401d9f2e3a164c7d3dceb70b18771">image</a>, <a class="code" href="classkeypoint.html" title="A 2D feature point as detected by a point detector (yape for example).">keypoint</a> *points, <span class="keywordtype">int</span> max_point_number) 
<a name="l00868"></a>00868 {
<a name="l00869"></a>00869   <a class="code" href="classyape.html#52bc96b62aca4025bd6f1a3a4525cf6d">reserve_tmp_arrays</a>();
<a name="l00870"></a>00870 
<a name="l00871"></a>00871   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=image-&gt;<a class="code" href="classPyrImage.html#bed0e465ecbeac3fba64d1370109ba7a">nbLev</a>-1; i&gt;=0; --i) 
<a name="l00872"></a>00872   {
<a name="l00873"></a>00873     <a class="code" href="classpyr__yape.html#c0ff6d645029953f0e4a1e18d04ce208">select_level</a>(i);
<a name="l00874"></a>00874     <a class="code" href="classyape.html#e6308aa6b883f57a3fa7bd0c548d1d7a" title="detect interest points and add them to tmp_points.">raw_detect</a>(image-&gt;<a class="code" href="classPyrImage.html#193d0624ee9ace7dc4f09d8e5188e1da">images</a>[i]);
<a name="l00875"></a>00875     <a class="code" href="classyape.html#885bc853270ce86bba10f9617dbe0f2d">get_local_maxima</a>(image-&gt;<a class="code" href="classPyrImage.html#193d0624ee9ace7dc4f09d8e5188e1da">images</a>[i], <a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a>, <span class="keywordtype">float</span>(i));
<a name="l00876"></a>00876   }
<a name="l00877"></a>00877 
<a name="l00878"></a>00878   <span class="keywordtype">int</span> n = <a class="code" href="classyape.html#f362d61fb20ed46554374d6288f23175" title="sort and select the max_point_number best features.">pick_best_points</a>(points, max_point_number);
<a name="l00879"></a>00879   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++) {
<a name="l00880"></a>00880     <span class="keywordtype">int</span> l =(int)points[i].scale;
<a name="l00881"></a>00881     <a class="code" href="classpyr__yape.html#c0ff6d645029953f0e4a1e18d04ce208">select_level</a>(l);
<a name="l00882"></a>00882     <a class="code" href="classyape.html#68311f372ad969d27228f0cd01e55310">subpix_refine</a>(image-&gt;<a class="code" href="classPyrImage.html#193d0624ee9ace7dc4f09d8e5188e1da">images</a>[l], points + i);
<a name="l00883"></a>00883   }
<a name="l00884"></a>00884 
<a name="l00885"></a>00885   <span class="keywordflow">return</span> n;
<a name="l00886"></a>00886 }
<a name="l00887"></a>00887 
<a name="l00903"></a><a class="code" href="classpyr__yape.html#4d2c94707fdaf5e72e7f9e9a9cbbb314">00903</a> <span class="keywordtype">int</span> <a class="code" href="classpyr__yape.html#4d2c94707fdaf5e72e7f9e9a9cbbb314" title="Blur the given image, build a pyramid and call detect().">pyr_yape::pyramidBlurDetect</a>(IplImage *im, <a class="code" href="classkeypoint.html" title="A 2D feature point as detected by a point detector (yape for example).">keypoint</a> *points, <span class="keywordtype">int</span> max_point_number, <a class="code" href="classPyrImage.html" title="Multi-resolution pyramidal image.">PyrImage</a> *caller_pim)
<a name="l00904"></a>00904 {
<a name="l00905"></a>00905   assert(im-&gt;nChannels == 1);
<a name="l00906"></a>00906 
<a name="l00907"></a>00907   <a class="code" href="classPyrImage.html" title="Multi-resolution pyramidal image.">PyrImage</a> *pim;
<a name="l00908"></a>00908 
<a name="l00909"></a>00909   <span class="keywordflow">if</span> (caller_pim == 0) 
<a name="l00910"></a>00910   {
<a name="l00911"></a>00911     <span class="keywordflow">if</span> (<a class="code" href="classpyr__yape.html#b812538a04a4586cb4d04d75ab193f1f">internal_pim</a> &amp;&amp; ((<a class="code" href="classpyr__yape.html#b812538a04a4586cb4d04d75ab193f1f">internal_pim</a>-&gt;<a class="code" href="classPyrImage.html#193d0624ee9ace7dc4f09d8e5188e1da">images</a>[0]-&gt;width != im-&gt;width) 
<a name="l00912"></a>00912         || (<a class="code" href="classpyr__yape.html#b812538a04a4586cb4d04d75ab193f1f">internal_pim</a>-&gt;<a class="code" href="classPyrImage.html#193d0624ee9ace7dc4f09d8e5188e1da">images</a>[0]-&gt;height != im-&gt;height))) 
<a name="l00913"></a>00913     {
<a name="l00914"></a>00914       <span class="keyword">delete</span> <a class="code" href="classpyr__yape.html#b812538a04a4586cb4d04d75ab193f1f">internal_pim</a>;
<a name="l00915"></a>00915       <a class="code" href="classpyr__yape.html#b812538a04a4586cb4d04d75ab193f1f">internal_pim</a> = 0;
<a name="l00916"></a>00916     }
<a name="l00917"></a>00917 
<a name="l00918"></a>00918     <span class="keywordflow">if</span> (<a class="code" href="classpyr__yape.html#b812538a04a4586cb4d04d75ab193f1f">internal_pim</a> == 0)
<a name="l00919"></a>00919       <a class="code" href="classpyr__yape.html#b812538a04a4586cb4d04d75ab193f1f">internal_pim</a> = <span class="keyword">new</span> <a class="code" href="classPyrImage.html" title="Multi-resolution pyramidal image.">PyrImage</a>(cvCreateImage(cvGetSize(im), IPL_DEPTH_8U, 1), <a class="code" href="classpyr__yape.html#4ca91e38c164e6afcf1f40e3e0dcbacb">pscores</a>-&gt;<a class="code" href="classPyrImage.html#bed0e465ecbeac3fba64d1370109ba7a">nbLev</a>);
<a name="l00920"></a>00920 
<a name="l00921"></a>00921     pim = <a class="code" href="classpyr__yape.html#b812538a04a4586cb4d04d75ab193f1f">internal_pim</a>;
<a name="l00922"></a>00922   } 
<a name="l00923"></a>00923   <span class="keywordflow">else</span> 
<a name="l00924"></a>00924   {
<a name="l00925"></a>00925     pim = caller_pim;
<a name="l00926"></a>00926     assert (im-&gt;width == caller_pim-&gt;<a class="code" href="classPyrImage.html#193d0624ee9ace7dc4f09d8e5188e1da">images</a>[0]-&gt;width);
<a name="l00927"></a>00927   }
<a name="l00928"></a>00928 
<a name="l00929"></a>00929   <span class="keywordtype">int</span> gaussian_filter_size = 3;
<a name="l00930"></a>00930   <span class="keywordflow">if</span> (<a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a> &gt;= 5) gaussian_filter_size = 5;
<a name="l00931"></a>00931   <span class="keywordflow">if</span> (<a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a> &gt;= 7) gaussian_filter_size = 7;
<a name="l00932"></a>00932   cvSmooth(im, pim-&gt;<a class="code" href="classPyrImage.html#193d0624ee9ace7dc4f09d8e5188e1da">images</a>[0], CV_GAUSSIAN, gaussian_filter_size, gaussian_filter_size);
<a name="l00933"></a>00933 
<a name="l00934"></a>00934   pim-&gt;<a class="code" href="classPyrImage.html#b8984456ea1b1c319d5f6ac199c293a8" title="build the pyramid from level 0 by calling cvPyrDown()">build</a>();
<a name="l00935"></a>00935 
<a name="l00936"></a>00936   <span class="keywordflow">return</span> <a class="code" href="classpyr__yape.html#69e1c1bd2b024079637fd5328471cfb1" title="Call pyramidBlurDetect():.">detect</a>(pim, points, max_point_number);
<a name="l00937"></a>00937 }
<a name="l00938"></a>00938 
<a name="l00939"></a><a class="code" href="classpyr__yape.html#8dcc2d06f5e976930f3bf3b927300528">00939</a> <span class="keywordtype">void</span> <a class="code" href="classpyr__yape.html#8dcc2d06f5e976930f3bf3b927300528" title="Save a color image with the detected points on the original image. Useful for visualisation...">pyr_yape::save_image_of_detected_points</a>(<span class="keywordtype">char</span> * name, IplImage * <a class="code" href="artvertiser_8cpp.html#50c401d9f2e3a164c7d3dceb70b18771">image</a>, <a class="code" href="classkeypoint.html" title="A 2D feature point as detected by a point detector (yape for example).">keypoint</a> * points, <span class="keywordtype">int</span> points_nb)
<a name="l00940"></a>00940 {
<a name="l00941"></a>00941   IplImage * point_image = <a class="code" href="mcv_8cpp.html#00daa6acc2cf7a4add70027464dde828">mcvGrayToColor</a>(image);
<a name="l00942"></a>00942   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; points_nb; i++)
<a name="l00943"></a>00943     <a class="code" href="mcv_8cpp.html#2b5ba662a3284fedbc92105794f119cc">mcvCircle</a>(point_image,
<a name="l00944"></a>00944               (<span class="keywordtype">int</span>)<a class="code" href="classPyrImage.html#731d4bcd182e9e41d0d5c15edeb26c77" title="Convert a subpixel coordinate from one level to another.">PyrImage::convCoordf</a>(points[i].u, (<span class="keywordtype">int</span>)points[i].scale, 0), 
<a name="l00945"></a>00945               (<span class="keywordtype">int</span>)<a class="code" href="classPyrImage.html#731d4bcd182e9e41d0d5c15edeb26c77" title="Convert a subpixel coordinate from one level to another.">PyrImage::convCoordf</a>(points[i].v, (<span class="keywordtype">int</span>)points[i].scale, 0), 
<a name="l00946"></a>00946               <a class="code" href="classPyrImage.html#df5a6bca223730dc74c2609959920ae5" title="Convert a coordinate from one level to another.">PyrImage::convCoord</a>(2 * <a class="code" href="classyape.html#173a51c019e578ae247d7db42e0c3cdf">radius</a>, (<span class="keywordtype">int</span>)points[i].scale, 0), <a class="code" href="mcv_8cpp.html#316e2e1ff0ab13832d77795bcb026ffa">mcvRainbowColor</a>((<span class="keywordtype">int</span>)points[i].scale), 1);
<a name="l00947"></a>00947   <a class="code" href="mcv_8cpp.html#c9dffb4820093e8353a009bc19b800a5">mcvSaveImage</a>(name, point_image);
<a name="l00948"></a>00948   cvReleaseImage(&amp;point_image);
<a name="l00949"></a>00949 }
<a name="l00950"></a>00950 
<a name="l00951"></a><a class="code" href="classpyr__yape.html#cf605689b69831a7c7c5923fad399617">00951</a> <span class="keywordtype">void</span> <a class="code" href="classpyr__yape.html#cf605689b69831a7c7c5923fad399617" title="compute and print on stdout a keypoint scale histogram.">pyr_yape::stat_points</a>(<a class="code" href="classkeypoint.html" title="A 2D feature point as detected by a point detector (yape for example).">keypoint</a> *points, <span class="keywordtype">int</span> nb_pts)
<a name="l00952"></a>00952 {
<a name="l00953"></a>00953   <span class="keywordtype">int</span> *histogram = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classpyr__yape.html#4ca91e38c164e6afcf1f40e3e0dcbacb">pscores</a>-&gt;<a class="code" href="classPyrImage.html#bed0e465ecbeac3fba64d1370109ba7a">nbLev</a>];
<a name="l00954"></a>00954 
<a name="l00955"></a>00955   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt; <a class="code" href="classpyr__yape.html#4ca91e38c164e6afcf1f40e3e0dcbacb">pscores</a>-&gt;<a class="code" href="classPyrImage.html#bed0e465ecbeac3fba64d1370109ba7a">nbLev</a>; ++l) histogram[l]=0;
<a name="l00956"></a>00956 
<a name="l00957"></a>00957   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nb_pts; ++i)
<a name="l00958"></a>00958     histogram[(<span class="keywordtype">int</span>)(points[i].<a class="code" href="classkeypoint.html#5cd322f1a3dbc35a2aae60a67f27b29b" title="point scale">scale</a>)]++;
<a name="l00959"></a>00959 
<a name="l00960"></a>00960   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt; <a class="code" href="classpyr__yape.html#4ca91e38c164e6afcf1f40e3e0dcbacb">pscores</a>-&gt;<a class="code" href="classPyrImage.html#bed0e465ecbeac3fba64d1370109ba7a">nbLev</a>; ++l)
<a name="l00961"></a>00961     cout &lt;&lt; <span class="stringliteral">"Level "</span> &lt;&lt; l &lt;&lt; <span class="stringliteral">": "</span> &lt;&lt; histogram[l] &lt;&lt; <span class="stringliteral">" keypoints ("</span> 
<a name="l00962"></a>00962          &lt;&lt; 100.0f * (<span class="keywordtype">float</span>)histogram[l]/(float)nb_pts &lt;&lt; <span class="stringliteral">"%)\n"</span>;
<a name="l00963"></a>00963 
<a name="l00964"></a>00964   <span class="keyword">delete</span>[] histogram;
<a name="l00965"></a>00965 }
<a name="l00966"></a>00966 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Aug 17 16:17:17 2009 for bazar by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
